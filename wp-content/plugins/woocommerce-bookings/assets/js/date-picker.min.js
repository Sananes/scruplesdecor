jQuery(function(a){var b={init:function(){a("body").on("change","#wc_bookings_field_duration, #wc_bookings_field_resource",this.date_picker_init),a("body").on("click",".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date",this.toggle_calendar),a("body").on("input",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_trigger),a("body").on("change",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_trigger),a(".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date").show(),a(".wc-bookings-date-picker").each(function(){var c=a(this).closest("form"),d=c.find(".picker"),e=a(this).closest("fieldset");b.date_picker_init(d),"always_visible"==d.data("display")?(a(".wc-bookings-date-picker-date-fields",e).hide(),a(".wc-bookings-date-picker-choose-date",e).hide()):d.hide(),d.data("is_range_picker_enabled")&&(c.find("p.wc_bookings_field_duration").hide(),c.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==d.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date))})},calc_duration:function(a){var b=a.closest("form"),c=a.closest("fieldset");setTimeout(function(){var a=1,d=parseInt(c.find("input.booking_to_date_year").val()),e=parseInt(c.find("input.booking_to_date_month").val()),f=parseInt(c.find("input.booking_to_date_day").val()),g=parseInt(c.find("input.booking_date_year").val()),h=parseInt(c.find("input.booking_date_month").val()),i=parseInt(c.find("input.booking_date_day").val());if(d&&e>=0&&f&&g&&h>=0&&i){var j=new Date(g,h-1,i),k=new Date(d,e-1,f);a=Math.floor((k.getTime()-j.getTime())/864e5)+1}b.find("#wc_bookings_field_duration").val(a).change()})},toggle_calendar:function(){$picker=a(this).closest("fieldset").find(".picker:eq(0)"),b.date_picker_init($picker),$picker.slideToggle()},input_date_trigger:function(){var c=a(this).closest("fieldset"),d=c.find(".picker:eq(0)"),e=a(this).closest("form"),f=parseInt(c.find("input.booking_date_year").val(),10),g=parseInt(c.find("input.booking_date_month").val(),10),h=parseInt(c.find("input.booking_date_day").val(),10);if(f&&g&&h){var i=new Date(f,g-1,h);if(d.datepicker("setDate",i),d.data("is_range_picker_enabled")){var j=parseInt(c.find("input.booking_to_date_year").val(),10),k=parseInt(c.find("input.booking_to_date_month").val(),10),l=parseInt(c.find("input.booking_to_date_day").val(),10),m=new Date(j,k-1,l);!m||i>m?(c.find("input.booking_to_date_year").val("").addClass("error"),c.find("input.booking_to_date_month").val("").addClass("error"),c.find("input.booking_to_date_day").val("").addClass("error")):(c.find("input").removeClass("error"),b.calc_duration(d))}e.find(".wc-bookings-booking-form").triggerHandler("date-selected",i)}},select_date_trigger:function(c){var d=a(this).closest("fieldset"),e=d.find(".picker:eq(0)"),f=a(this).closest("form"),g=c.split("-"),h=e.data("start_or_end_date");e.data("is_range_picker_enabled")&&h||(h="start"),"end"===h?(e.data("min_date","o_min_date"),d.find("input.booking_to_date_year").val(g[0]),d.find("input.booking_to_date_month").val(g[1]),d.find("input.booking_to_date_day").val(g[2]).change(),e.data("is_range_picker_enabled")&&b.calc_duration(e),e.data("start_or_end_date","start"),e.data("is_range_picker_enabled")&&f.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==e.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date),"always_visible"!==e.data("display")&&a(this).hide()):(e.data("is_range_picker_enabled")&&(e.data("o_min_date","min_date"),e.data("min_date",c)),d.find("input.booking_to_date_year").val(""),d.find("input.booking_to_date_month").val(""),d.find("input.booking_to_date_day").val(""),d.find("input.booking_date_year").val(g[0]),d.find("input.booking_date_month").val(g[1]),d.find("input.booking_date_day").val(g[2]).change(),e.data("is_range_picker_enabled")&&b.calc_duration(e),e.data("start_or_end_date","end"),e.data("is_range_picker_enabled")&&f.find(".wc_bookings_field_start_date legend span.label").text(booking_form_params.i18n_end_date),"always_visible"===e.data("display")||e.data("is_range_picker_enabled")||a(this).hide()),f.find(".wc-bookings-booking-form").triggerHandler("date-selected",c,h)},date_picker_init:function(c){if(a(c).is(".picker"))var d=a(c);else var d=a(this).closest("form").find(".picker:eq(0)");d.empty().removeClass("hasDatepicker").datepicker({dateFormat:a.datepicker.ISO_8601,showWeek:!1,showOn:!1,beforeShowDay:b.is_bookable,onSelect:b.select_date_trigger,minDate:d.data("min_date"),maxDate:d.data("max_date"),numberOfMonths:1,showButtonPanel:!1,showOtherMonths:!0,selectOtherMonths:!0,closeText:wc_bookings_booking_form.closeText,currentText:wc_bookings_booking_form.currentText,monthNames:wc_bookings_booking_form.monthNames,monthNamesShort:wc_bookings_booking_form.monthNamesShort,dayNames:wc_bookings_booking_form.dayNames,dayNamesShort:wc_bookings_booking_form.dayNamesShort,dayNamesMin:wc_bookings_booking_form.dayNamesMin,firstDay:wc_bookings_booking_form.firstDay,gotoCurrent:!0}),a(".ui-datepicker-current-day").removeClass("ui-datepicker-current-day");var e=d.closest("form"),f=parseInt(e.find("input.booking_date_year").val(),10),g=parseInt(e.find("input.booking_date_month").val(),10),h=parseInt(e.find("input.booking_date_day").val(),10);if(f&&g&&h){var i=new Date(f,g-1,h);d.datepicker("setDate",i)}},get_input_date:function(a,b){var c=a.find("input.booking_"+b+"date_year"),d=a.find("input.booking_"+b+"date_month"),e=a.find("input.booking_"+b+"date_day");return 0!==c.val().length&&0!==d.val().length&&0!==e.val().length?c.val()+"-"+d.val()+"-"+e.val():""},is_bookable:function(c){var d=a(this).closest("form"),e=d.find(".picker:eq(0)"),f=a(this).data("availability"),g=a(this).data("default-availability"),h=a(this).data("fully-booked-days"),i=a(this).data("partially-booked-days"),j=wc_bookings_booking_form.check_availability_against,k="";if(d.find("select#wc_bookings_field_resource").val()>0)var l=d.find("select#wc_bookings_field_resource").val();else var l=0;var m=wc_bookings_booking_form.booking_duration,n=new Date(c),o=n.getFullYear(),p=n.getMonth()+1,q=n.getDate();if(h[o+"-"+p+"-"+q]&&(h[o+"-"+p+"-"+q][0]||h[o+"-"+p+"-"+q][l]))return[!1,"fully_booked",booking_form_params.i18n_date_unavailable];if(""+o+p+q<wc_bookings_booking_form.current_time)return[!1,"not_bookable",""];if(i&&i[o+"-"+p+"-"+q]&&(i[o+"-"+p+"-"+q][0]||i[o+"-"+p+"-"+q][l])&&(k+="partial_booked "),d.find("#wc_bookings_field_duration").size()>0&&"minute"!=wc_bookings_booking_form.duration_unit&&"hour"!=wc_bookings_booking_form.duration_unit&&!e.data("is_range_picker_enabled"))var r=d.find("#wc_bookings_field_duration").val(),s=m*r;else var s=m;(1>s||"start"==j)&&(s=1);for(var t=g,u=0;s>u;u++){var n=new Date(c);n.setDate(n.getDate()+u);var o=n.getFullYear(),p=n.getMonth()+1,q=n.getDate(),v=n.getDay(),w=a.datepicker.iso8601Week(n);if(t=g,0==v&&(v=7),a.each(f[l],function(a,b){var c=b[0],d=b[1];try{switch(c){case"months":if("undefined"!=typeof d[p])return t=d[p],!1;break;case"weeks":if("undefined"!=typeof d[w])return t=d[w],!1;break;case"days":if("undefined"!=typeof d[v])return t=d[v],!1;break;case"custom":if("undefined"!=typeof d[o][p][q])return t=d[o][p][q],!1}}catch(e){}return!0}),h[o+"-"+p+"-"+q]&&(h[o+"-"+p+"-"+q][0]||h[o+"-"+p+"-"+q][l])&&(t=!1),!t)break}if(t){if(e.data("is_range_picker_enabled")){var x=a(this).closest("fieldset"),y=a.datepicker.parseDate(a.datepicker.ISO_8601,b.get_input_date(x,"")),z=a.datepicker.parseDate(a.datepicker.ISO_8601,b.get_input_date(x,"to_"));return[t,y&&(c.getTime()===y.getTime()||z&&c>=y&&z>=c)?k+"bookable-range":k+"bookable",""]}return[t,k+"bookable",""]}return[t,"not_bookable",""]}};b.init()});