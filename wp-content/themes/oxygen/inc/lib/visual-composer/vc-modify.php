<?php
/**
 *	This will add better support for Visual Composer in Oxygen Theme
 *
 *	Laborator.co
 *	www.laborator.co
 */

$lvcm_min_version = '4.4.0';
$lvcm_max_version = '4.6.5';

$plugin_dir = 'js_composer';

$files = array(
	'include/classes/core/class-wpb-map.php' => 'PD9waHANCi8qKg0KICogV1BCYWtlcnkgVmlzdWFsIENvbXBvc2VyIE1haW4gbWFuYWdlci4NCiAqDQogKiBAcGFja2FnZSBXUEJha2VyeVZpc3VhbENvbXBvc2VyDQogKiBAc2luY2UgICA0LjINCiAqLw0KDQovKioNCiAqIFZjIG1hcHBlciBuZXcgY2xhc3MuDQogKg0KICogVGhpcyBjbGFzcyBtYXBzIHNob3J0Y29kZXMgc2V0dGluZ3MgdG8gVkMgZWRpdG9ycy4gWW91IGNhbiBtYW5hZ2UgYWRkIG5ldyBzaG9ydGNvZGVzIG9yIG1hbmFnZSBkZWZhdWx0IHNob3J0Y29kZXMNCiAqIG1hcHBlZCBpbiBjb25maWcvbWFwLnBocC4gRm9yIGRldmVsb3BlcnMgaXQgaXMgcG9zc2libGUgdG8gdXNlIEFQSSBmdW5jdGlvbnMgdG8gYWRkIHVwZGF0ZSBzZXR0aW5ncyBhdHRyaWJ1dGVzLg0KICoNCiAqIEBzZWUgY29uZmlnL21hcC5waHANCiAqIEBzZWUgaW5jbHVkZS9oZWxwZXJzL2hlbHBlcnNfYXBpLnBocA0KICogQHNpbmNlIDMuMQ0KICoNCiAqLw0KY2xhc3MgV1BCTWFwIHsNCg0KCS8qKg0KCSAqIEB2YXIgYXJyYXkNCgkgKi8NCglwcm90ZWN0ZWQgc3RhdGljICRzYyA9IEFycmF5KCk7DQoNCgkvKioNCgkgKiBAdmFyIGFycmF5DQoJICovDQoJcHJvdGVjdGVkIHN0YXRpYyAkY2F0ZWdvcmllcyA9IEFycmF5KCk7DQoNCgkvKioNCgkgKiBAdmFyIGJvb2wNCgkgKi8NCglwcm90ZWN0ZWQgc3RhdGljICR1c2VyX3NjID0gZmFsc2U7DQoNCgkvKioNCgkgKiBAdmFyIGJvb2wNCgkgKi8NCglwcm90ZWN0ZWQgc3RhdGljICR1c2VyX3NvcnRlZF9zYyA9IGZhbHNlOw0KDQoJLyoqDQoJICogQHZhciBib29sDQoJICovDQoJcHJvdGVjdGVkIHN0YXRpYyAkdXNlcl9jYXRlZ29yaWVzID0gZmFsc2U7DQoNCgkvKioNCgkgKiBAdmFyIFZjX1NldHRpbmdzICRzZXR0aW5ncw0KCSAqLw0KCXByb3RlY3RlZCBzdGF0aWMgJHNldHRpbmdzOw0KDQoJLyoqDQoJICogQHZhcg0KCSAqLw0KCXByb3RlY3RlZCBzdGF0aWMgJHVzZXJfcm9sZTsNCg0KCS8qKg0KCSAqIEB2YXINCgkgKi8NCglwcm90ZWN0ZWQgc3RhdGljICR0YWdzX3JlZ2V4cDsNCg0KCS8qKg0KCSAqIEB2YXIgYm9vbA0KCSAqLw0KCXByb3RlY3RlZCBzdGF0aWMgJGlzX2luaXQgPSBmYWxzZTsNCg0KCS8qKg0KCSAqIFNldCBpbml0IHN0YXR1cyBmcm8gV1BNYXAuDQoJICoNCgkgKiBpZiAkaXNfaW5pdCBpcyBGQUxTRSwgdGhlbiBhbGwgYWN0aXZpdHkgbGlrZSBhZGQsIHVwZGF0ZSBhbmQgZGVsZXRlIGZvciBzaG9ydGNvZGVzIGF0dHJpYnV0ZXMgd2lsbCBiZSBob2xkIGluDQoJICogdGhlIGxpc3Qgb2YgYWN0aXZpdHkgYW5kIHdpbGwgYmUgZXhlY3V0ZWQgYWZ0ZXIgaW5pdGlhbGl6YXRpb24uDQoJICoNCgkgKiBAc2VlIFZjX01hcHBlcjo6aW5peS4NCgkgKiBAc3RhdGljDQoJICoNCgkgKiBAcGFyYW0gYm9vbCAkdmFsdWUNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHNldEluaXQoICR2YWx1ZSA9IHRydWUgKSB7DQoJCXNlbGY6OiRpc19pbml0ID0gJHZhbHVlOw0KCX0NCg0KCS8qKg0KCSAqIEdldHMgdXNlciByb2xlIGFuZCBhY2Nlc3MgcnVsZXMgZm9yIGN1cnJlbnQgdXNlci4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKiBAcmV0dXJuIG1peGVkDQoJICovDQoJcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBnZXRTZXR0aW5ncygpIHsNCgkJZ2xvYmFsICRjdXJyZW50X3VzZXI7DQoNCgkJaWYgKCBzZWxmOjokc2V0dGluZ3MgPT09IG51bGwgKSB7DQoJCQlpZiAoIGZ1bmN0aW9uX2V4aXN0cyggJ2dldF9jdXJyZW50dXNlcmluZm8nICkgKSB7DQoJCQkJZ2V0X2N1cnJlbnR1c2VyaW5mbygpOw0KCQkJCS8qKiBAdmFyIFZjX1NldHRpbmdzICRzZXR0aW5ncyAtIGdldCB1c2UgZ3JvdXAgYWNjZXNzIHJ1bGVzICovDQoJCQkJaWYgKCAhIGVtcHR5KCAkY3VycmVudF91c2VyLT5yb2xlcyApICkgew0KCQkJCQlzZWxmOjokdXNlcl9yb2xlID0gJGN1cnJlbnRfdXNlci0+cm9sZXNbMF07DQoJCQkJfSBlbHNlIHsNCgkJCQkJc2VsZjo6JHVzZXJfcm9sZSA9ICdhdXRob3InOw0KCQkJCX0NCgkJCX0gZWxzZSB7DQoJCQkJc2VsZjo6JHVzZXJfcm9sZSA9ICdhdXRob3InOw0KCQkJfQ0KCQkJc2VsZjo6JHNldHRpbmdzID0gdmNfc2V0dGluZ3MoKS0+Z2V0KCAnZ3JvdXBzX2FjY2Vzc19ydWxlcycgKTsNCgkJfQ0KDQoJCXJldHVybiBzZWxmOjokc2V0dGluZ3M7DQoJfQ0KDQoJLyoqDQoJICogQ2hlY2sgaXMgc2hvcnRjb2RlIHdpdGggYSB0YWcgbWFwcGVkIHRvIFZDLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqDQoJICogQHBhcmFtICR0YWcgLSBzaG9ydGNvZGUgdGFnLg0KCSAqDQoJICogQHJldHVybiBib29sDQoJICovDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBleGlzdHMoICR0YWcgKSB7DQoJCXJldHVybiAoYm9vbGVhbikgaXNzZXQoIHNlbGY6OiRzY1sgJHRhZyBdICk7DQoJfQ0KDQoJLyoqDQoJICogTWFwIHNob3J0Y29kZSB0byBWQy4NCgkgKg0KCSAqIFRoaXMgbWV0aG9kIG1hcHMgc2hvcnRjb2RlIHRvIFZDLg0KCSAqIFlvdSBuZWVkIHRvIHNob3J0Y29kZSdzIHRhZyBhbmQgIHNldHRpbmdzIHRvIG1hcCBjb3JyZWN0bHkuDQoJICogRGVmYXVsdCBzaG9ydGNvZGVzIGFyZSBtYXBwZWQgaW4gY29uZmlnL21hcC5waHAgZmlsZS4NCgkgKiBUaGUgYmVzdCB3YXkgaXMgdG8gY2FsbCB0aGlzIG1ldGhvZCB3aXRoICJpbml0IiBhY3Rpb24gY2FsbGJhY2sgZnVuY3Rpb24gb2YgV1AuDQoJICoNCgkgKiB2Y19maWx0ZXI6IHZjX21hcHBlcl90YWcgLSB0byBjaGFuZ2Ugc2hvcnRjb2RlIHRhZywgYXJndW1lbnRzIDIgKCAkdGFnLCAkYXR0cmlidXRlcyApDQoJICogdmNfZmlsdGVyOiB2Y19tYXBwZXJfYXR0cmlidXRlcyAtIHRvIGNoYW5nZSBzaG9ydGNvZGUgYXR0cmlidXRlcyAobGlrZSBwYXJhbXMgYXJyYXkpLCBhcmd1bWVudHMgMiAoICRhdHRyaWJ1dGVzLA0KCSAqICR0YWcgKSB2Y19maWx0ZXI6IHZjX21hcHBlcl9hdHRyaWJ1dGUgLSB0byBjaGFuZ2Ugc2luZ2Ugc2hvcnRjb2RlIHBhcmFtIGRhdGEsIGFyZ3VtZW50cyAyICggJGF0dHJpYnV0ZSwgJHRhZyApDQoJICogdmNfZmlsdGVyOiB2Y19tYXBwZXJfYXR0cmlidXRlX3tQQVJBTV9UWVBFfSAtIHRvIGNoYW5nZSBzaW5nZSBzaG9ydGNvZGUgcGFyYW0gZGF0YSBieSBwYXJhbSB0eXBlLCBhcmd1bWVudHMgMiAoDQoJICogJGF0dHJpYnV0ZSwgJHRhZyApDQoJICoNCgkgKiBAc3RhdGljDQoJICoNCgkgKiBAcGFyYW0gJHRhZw0KCSAqIEBwYXJhbSAkYXR0cmlidXRlcw0KCSAqDQoJICogQHJldHVybiBib29sDQoJICovDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBtYXAoICR0YWcsICRhdHRyaWJ1dGVzICkgew0KCQlpZiAoICEgc2VsZjo6JGlzX2luaXQgKSB7DQoJCQlpZiAoIGVtcHR5KCAkYXR0cmlidXRlc1snbmFtZSddICkgKSB7DQoJCQkJdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICJXcm9uZyBuYW1lIGZvciBzaG9ydGNvZGU6JXMuIE5hbWUgcmVxdWlyZWQiLCAianNfY29tcG9zZXIiICksICR0YWcgKSApOw0KCQkJfSBlbHNlaWYgKCBlbXB0eSggJGF0dHJpYnV0ZXNbJ2Jhc2UnXSApICkgew0KCQkJCXRyaWdnZXJfZXJyb3IoIHNwcmludGYoIF9fKCAiV3JvbmcgYmFzZSBmb3Igc2hvcnRjb2RlOiVzLiBCYXNlIHJlcXVpcmVkIiwgImpzX2NvbXBvc2VyIiApLCAkdGFnICkgKTsNCgkJCX0gZWxzZSB7DQoJCQkJdmNfbWFwcGVyKCktPmFkZEFjdGl2aXR5KA0KCQkJCQknbWFwcGVyJywgJ21hcCcsIGFycmF5KA0KCQkJCQkJJ3RhZycgPT4gJHRhZywNCgkJCQkJCSdhdHRyaWJ1dGVzJyA9PiAkYXR0cmlidXRlcw0KCQkJCQkpDQoJCQkJKTsNCg0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KDQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCgkJaWYgKCBlbXB0eSggJGF0dHJpYnV0ZXNbJ25hbWUnXSApICkgew0KCQkJdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICJXcm9uZyBuYW1lIGZvciBzaG9ydGNvZGU6JXMuIE5hbWUgcmVxdWlyZWQiLCAianNfY29tcG9zZXIiICksICR0YWcgKSApOw0KCQl9IGVsc2VpZiAoIGVtcHR5KCAkYXR0cmlidXRlc1snYmFzZSddICkgKSB7DQoJCQl0cmlnZ2VyX2Vycm9yKCBzcHJpbnRmKCBfXyggIldyb25nIGJhc2UgZm9yIHNob3J0Y29kZTolcy4gQmFzZSByZXF1aXJlZCIsICJqc19jb21wb3NlciIgKSwgJHRhZyApICk7DQoJCX0gZWxzZSB7DQoNCgkJCSMgc3RhcnQ6IG1vZGlmaWVkIGJ5IEFybGluZCBOdXNoaQ0KCQkJJGF0dHJpYnV0ZXMgPSBhcHBseV9maWx0ZXJzKCdsYWJfdmNfbWFwX2F0dHJzJywgJGF0dHJpYnV0ZXMpOw0KDQoJCQlpZiggISAkYXR0cmlidXRlcyAmJiBpc3NldChzZWxmOjokc2NbJG5hbWVdKSkNCgkJCXsNCgkJCQl1bnNldChzZWxmOjokc2NbJG5hbWVdKTsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoJCQkjIGVuZDogbW9kaWZpZWQgYnkgQXJsaW5kIE51c2hpDQoJCQkNCgkJCXNlbGY6OiRzY1sgJHRhZyBdID0gJGF0dHJpYnV0ZXM7DQoJCQkvLyBzZWxmOjokc2NbICR0YWcgXVsncGFyYW1zJ10gPSBBcnJheSgpOw0KDQoJCQl2aXN1YWxfY29tcG9zZXIoKS0+YWRkU2hvcnRDb2RlKCBzZWxmOjokc2NbICR0YWcgXSApOw0KDQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KDQoJCXJldHVybiBmYWxzZTsNCgl9DQoNCgkvKioNCgkgKiBHZW5lcmF0ZXMgbGlzdCBvZiBzaG9ydGNvZGVzIHRha2luZyBpbnRvIGFjY291bnQgdGhlIGFjY2VzcyBydWxlcyBmb3Igc2hvcnRjb2RlcyBmcm9tIFZDIFNldHRpbmdzIHBhZ2UuDQoJICoNCgkgKiBUaGlzIG1ldGhvZCBwYXJzZXMgdGhlIGxpc3Qgb2YgbWFwcGVkIHNob3J0Y29kZXMgYW5kIGNyZWF0ZXMgY2F0ZWdvcmllcyBsaXN0IGZvciB1c2Vycy4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKg0KCSAqIEBwYXJhbSBib29sICRmb3JjZSAtIGZvcmNlIGRhdGEgZ2VuZXJhdGlvbiBldmVuIGRhdGEgYWxyZWFkeSBnZW5lcmF0ZWQuDQoJICovDQoJcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBnZW5lcmF0ZVVzZXJEYXRhKCAkZm9yY2UgPSBmYWxzZSApIHsNCgkJaWYgKCAhICRmb3JjZSAmJiBzZWxmOjokdXNlcl9zYyAhPT0gZmFsc2UgJiYgc2VsZjo6JHVzZXJfY2F0ZWdvcmllcyAhPT0gZmFsc2UgKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQkkc2V0dGluZ3MgPSBzZWxmOjpnZXRTZXR0aW5ncygpOw0KCQlzZWxmOjokdXNlcl9zYyA9IHNlbGY6OiR1c2VyX2NhdGVnb3JpZXMgPSBzZWxmOjokdXNlcl9zb3J0ZWRfc2MgPSBhcnJheSgpOw0KCQkkZGVwcmVjYXRlZCA9ICdkZXByZWNhdGVkJzsNCgkJJGFkZF9kZXByZWNhdGVkID0gZmFsc2U7DQoJCWlmICggaXNfYXJyYXkoIHNlbGY6OiRzYyApICYmICEgZW1wdHkoIHNlbGY6OiRzYyApICkgew0KCQkJZm9yZWFjaCAoIHNlbGY6OiRzYyBhcyAkbmFtZSA9PiAkdmFsdWVzICkgew0KCQkJCWlmICggaW5fYXJyYXkoICRuYW1lLCBhcnJheSgNCgkJCQkJCSd2Y19jb2x1bW4nLA0KCQkJCQkJJ3ZjX3JvdycsDQoJCQkJCQkndmNfcm93X2lubmVyJywNCgkJCQkJCSd2Y19jb2x1bW5faW5uZXInDQoJCQkJCSkgKSB8fCAhIGlzc2V0KCAkc2V0dGluZ3NbIHNlbGY6OiR1c2VyX3JvbGUgXVsnc2hvcnRjb2RlcyddICkNCgkJCQkgICAgIHx8ICggaXNzZXQoICRzZXR0aW5nc1sgc2VsZjo6JHVzZXJfcm9sZSBdWydzaG9ydGNvZGVzJ11bICRuYW1lIF0gKSAmJiAoaW50KSAkc2V0dGluZ3NbIHNlbGY6OiR1c2VyX3JvbGUgXVsnc2hvcnRjb2RlcyddWyAkbmFtZSBdID09IDEgKQ0KCQkJCSkgew0KCQkJCQlpZiAoICEgaXNzZXQoICR2YWx1ZXNbJ2NvbnRlbnRfZWxlbWVudCddICkgfHwgJHZhbHVlc1snY29udGVudF9lbGVtZW50J10gPT09IHRydWUgKSB7DQoJCQkJCQkkY2F0ZWdvcmllcyA9IGlzc2V0KCAkdmFsdWVzWydjYXRlZ29yeSddICkgPyAkdmFsdWVzWydjYXRlZ29yeSddIDogJ19vdGhlcl9jYXRlZ29yeV8nOw0KCQkJCQkJJHZhbHVlc1snX2NhdGVnb3J5X2lkcyddID0gYXJyYXkoKTsNCgkJCQkJCWlmICggaXNzZXQoICR2YWx1ZXNbJ2RlcHJlY2F0ZWQnXSApICYmICR2YWx1ZXNbJ2RlcHJlY2F0ZWQnXSAhPT0gZmFsc2UgKSB7DQoJCQkJCQkJJGFkZF9kZXByZWNhdGVkID0gdHJ1ZTsNCgkJCQkJCQkkdmFsdWVzWydfY2F0ZWdvcnlfaWRzJ11bXSA9ICdkZXByZWNhdGVkJzsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJaWYgKCBpc19hcnJheSggJGNhdGVnb3JpZXMgKSAmJiAhIGVtcHR5KCAkY2F0ZWdvcmllcyApICkgew0KCQkJCQkJCQlmb3JlYWNoICggJGNhdGVnb3JpZXMgYXMgJGMgKSB7DQoJCQkJCQkJCQlpZiAoIGFycmF5X3NlYXJjaCggJGMsIHNlbGY6OiR1c2VyX2NhdGVnb3JpZXMgKSA9PT0gZmFsc2UgKSB7DQoJCQkJCQkJCQkJc2VsZjo6JHVzZXJfY2F0ZWdvcmllc1tdID0gJGM7DQoJCQkJCQkJCQl9DQoJCQkJCQkJCQkkdmFsdWVzWydfY2F0ZWdvcnlfaWRzJ11bXSA9IG1kNSggJGMgKTsgLy8gYXJyYXlfc2VhcmNoKCRjYXRlZ29yeSwgc2VsZjo6JGNhdGVnb3JpZXMpOw0KCQkJCQkJCQl9DQoJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJaWYgKCBhcnJheV9zZWFyY2goICRjYXRlZ29yaWVzLCBzZWxmOjokdXNlcl9jYXRlZ29yaWVzICkgPT09IGZhbHNlICkgew0KCQkJCQkJCQkJc2VsZjo6JHVzZXJfY2F0ZWdvcmllc1tdID0gJGNhdGVnb3JpZXM7DQoJCQkJCQkJCX0NCgkJCQkJCQkJJHZhbHVlc1snX2NhdGVnb3J5X2lkcyddW10gPSBtZDUoICRjYXRlZ29yaWVzICk7IC8vIGFycmF5X3NlYXJjaCgkY2F0ZWdvcnksIHNlbGY6OiRjYXRlZ29yaWVzKTsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0NCg0KCQkJCQlzZWxmOjokdXNlcl9zY1sgJG5hbWUgXSA9ICR2YWx1ZXM7DQoJCQkJCXNlbGY6OiR1c2VyX3NvcnRlZF9zY1tdID0gJHZhbHVlczsNCgkJCQl9DQoJCQl9DQoJCX0NCgkJaWYgKCAkYWRkX2RlcHJlY2F0ZWQgKSB7DQoJCQlzZWxmOjokdXNlcl9jYXRlZ29yaWVzW10gPSAkZGVwcmVjYXRlZDsNCgkJfQ0KDQoJCSRzb3J0ID0gbmV3IFZjX1NvcnQoIHNlbGY6OiR1c2VyX3NvcnRlZF9zYyApOw0KCQlzZWxmOjokdXNlcl9zb3J0ZWRfc2MgPSAkc29ydC0+c29ydEJ5S2V5KCk7DQoJfQ0KDQoJLyoqDQoJICogR2V0IG1hcHBlZCBzaG9ydGNvZGUgc2V0dGluZ3MuDQoJICoNCgkgKiBAc3RhdGljDQoJICogQHJldHVybiBhcnJheQ0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0U2hvcnRDb2RlcygpIHsNCgkJcmV0dXJuIHNlbGY6OiRzYzsNCgl9DQoNCgkvKioNCgkgKiBHZXQgc29ydGVkIGxpc3Qgb2YgbWFwcGVkIHNob3J0Y29kZSBzZXR0aW5ncyBmb3IgY3VycmVudCB1c2VyLg0KCSAqDQoJICogU29ydGluZyBkZXBlbmRzIG9uIHRoZSB3ZWlnaHQgYXR0cmlidXRlIGFuZCBtYXBwaW5nIG9yZGVyLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqIEByZXR1cm4gYXJyYXkNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFNvcnRlZFVzZXJTaG9ydENvZGVzKCkgew0KCQlzZWxmOjpnZW5lcmF0ZVVzZXJEYXRhKCk7DQoNCgkJcmV0dXJuIHNlbGY6OiR1c2VyX3NvcnRlZF9zYzsNCgl9DQoNCgkvKioNCgkgKiBHZXQgbGlzdCBvZiBtYXBwZWQgc2hvcnRjb2RlIHNldHRpbmdzIGZvciBjdXJyZW50IHVzZXIuDQoJICogQHN0YXRpYw0KCSAqIEByZXR1cm4gYXJyYXkgLSBhc3NvY2lhdGVkIGFycmF5IG9mIHNob3J0Y29kZXMgc2V0dGluZ3Mgd2l0aCB0YWcgYXMgdGhlIGtleS4NCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFVzZXJTaG9ydENvZGVzKCkgew0KCQlzZWxmOjpnZW5lcmF0ZVVzZXJEYXRhKCk7DQoNCgkJcmV0dXJuIHNlbGY6OiR1c2VyX3NjOw0KCX0NCg0KCS8qKg0KCSAqIEdldCBtYXBwZWQgc2hvcnRjb2RlIHNldHRpbmdzIGJ5IHRhZy4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKg0KCSAqIEBwYXJhbSAkdGFnIC0gc2hvcnRjb2RlIHRhZy4NCgkgKg0KCSAqIEByZXR1cm4gYXJyYXl8bnVsbCBudWxsIEBzaW5jZSA0LjQuMw0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0U2hvcnRDb2RlKCAkdGFnICkgew0KCQlyZXR1cm4gaXNzZXQoIHNlbGY6OiRzY1sgJHRhZyBdICkgJiYgaXNfYXJyYXkoIHNlbGY6OiRzY1sgJHRhZyBdICkgPyBzZWxmOjokc2NbICR0YWcgXSA6IG51bGw7DQoJfQ0KDQoJLyoqDQoJICogR2V0IG1hcHBlZCBzaG9ydGNvZGUgc2V0dGluZ3MgYnkgdGFnLg0KCSAqDQoJICogQHNpbmNlIDQuNS4yDQoJICogQHN0YXRpYw0KCSAqDQoJICogQHBhcmFtICR0YWcgLSBzaG9ydGNvZGUgdGFnLg0KCSAqDQoJICogQHJldHVybiBhcnJheXxudWxsDQoJICovDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRVc2VyU2hvcnRDb2RlKCAkdGFnICkgew0KCQlzZWxmOjpnZW5lcmF0ZVVzZXJEYXRhKCk7DQoJCWlmICggaXNzZXQoIHNlbGY6OiR1c2VyX3NjWyAkdGFnIF0gKSAmJiBpc19hcnJheSggc2VsZjo6JHVzZXJfc2NbICR0YWcgXSApICkgew0KCQkJJHNob3J0Y29kZSA9IHNlbGY6OiR1c2VyX3NjWyAkdGFnIF07DQoJCQlpZiAoICEgZW1wdHkoICRzaG9ydGNvZGVbJ3BhcmFtcyddICkgKSB7DQoJCQkJJHBhcmFtcyA9ICRzaG9ydGNvZGVbJ3BhcmFtcyddOw0KCQkJCSRzaG9ydGNvZGVbJ3BhcmFtcyddID0gYXJyYXkoKTsNCgkJCQlmb3JlYWNoICggJHBhcmFtcyBhcyAkYXR0cmlidXRlICkgew0KCQkJCQkkYXR0cmlidXRlID0gYXBwbHlfZmlsdGVycyggJ3ZjX21hcHBlcl9hdHRyaWJ1dGUnLCAkYXR0cmlidXRlLCAkdGFnICk7DQoJCQkJCSRhdHRyaWJ1dGUgPSBhcHBseV9maWx0ZXJzKCAndmNfbWFwcGVyX2F0dHJpYnV0ZV8nIC4gJGF0dHJpYnV0ZVsndHlwZSddLCAkYXR0cmlidXRlLCAkdGFnICk7DQoJCQkJCSRzaG9ydGNvZGVbJ3BhcmFtcyddW10gPSAkYXR0cmlidXRlOw0KCQkJCX0NCgkJCQkkc29ydCA9IG5ldyBWY19Tb3J0KCAkc2hvcnRjb2RlWydwYXJhbXMnXSApOw0KCQkJCSRzaG9ydGNvZGVbJ3BhcmFtcyddID0gJHNvcnQtPnNvcnRCeUtleSgpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gJHNob3J0Y29kZTsNCgkJfQ0KDQoJCXJldHVybiBudWxsOw0KCX0NCg0KCS8qKg0KCSAqIEdldCBhbGwgY2F0ZWdvcmllcyBmb3IgbWFwcGVkIHNob3J0Y29kZXMuDQoJICoNCgkgKiBAc3RhdGljDQoJICogQHJldHVybiBhcnJheQ0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0Q2F0ZWdvcmllcygpIHsNCgkJcmV0dXJuIHNlbGY6OiRjYXRlZ29yaWVzOw0KCX0NCg0KCS8qKg0KCSAqIEdldCBhbGwgY2F0ZWdvcmllcyBmb3IgY3VycmVudCB1c2VyLg0KCSAqDQoJICogQ2F0ZWdvcnkgaXMgYWRkZWQgdG8gdGhlIGxpc3Qgd2hlbiBhdCBsZWFzdCBvbmUgc2hvcnRjb2RlIG9mIHRoaXMgY2F0ZWdvcnkgaXMgYWxsb3dlZCBmb3IgY3VycmVudCB1c2VyDQoJICogYnkgVmMgYWNjZXNzIHJ1bGVzLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqIEByZXR1cm4gYXJyYXkNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFVzZXJDYXRlZ29yaWVzKCkgew0KCQlzZWxmOjpnZW5lcmF0ZVVzZXJEYXRhKCk7DQoNCgkJcmV0dXJuIHNlbGY6OiR1c2VyX2NhdGVnb3JpZXM7DQoJfQ0KDQoJLyoqDQoJICogRHJvcCBzaG9ydGNvZGUgcGFyYW0uDQoJICoNCgkgKiBAc3RhdGljDQoJICoNCgkgKiBAcGFyYW0gJG5hbWUNCgkgKiBAcGFyYW0gJGF0dHJpYnV0ZV9uYW1lDQoJICoNCgkgKiBAcmV0dXJuIGJvb2wNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGRyb3BQYXJhbSggJG5hbWUsICRhdHRyaWJ1dGVfbmFtZSApIHsNCgkJaWYgKCAhIHNlbGY6OiRpc19pbml0ICkgew0KCQkJdmNfbWFwcGVyKCktPmFkZEFjdGl2aXR5KA0KCQkJCSdtYXBwZXInLCAnZHJvcF9wYXJhbScsIGFycmF5KA0KCQkJCQknbmFtZScgPT4gJG5hbWUsDQoJCQkJCSdhdHRyaWJ1dGVfbmFtZScgPT4gJGF0dHJpYnV0ZV9uYW1lDQoJCQkJKQ0KCQkJKTsNCg0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgkJZm9yZWFjaCAoIHNlbGY6OiRzY1sgJG5hbWUgXVsncGFyYW1zJ10gYXMgJGluZGV4ID0+ICRwYXJhbSApIHsNCgkJCWlmICggJHBhcmFtWydwYXJhbV9uYW1lJ10gPT0gJGF0dHJpYnV0ZV9uYW1lICkgew0KCQkJCWFycmF5X3NwbGljZSggc2VsZjo6JHNjWyAkbmFtZSBdWydwYXJhbXMnXSwgJGluZGV4LCAxICk7DQoNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0NCgkJfQ0KDQoJCXJldHVybiB0cnVlOw0KCX0NCg0KCS8qKg0KCSAqIFJldHVybnMgcGFyYW0gc2V0dGluZ3MgZm9yIG1hcHBlZCBzaG9ydGNvZGVzLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqDQoJICogQHBhcmFtICR0YWcNCgkgKiBAcGFyYW0gJHBhcmFtX25hbWUNCgkgKg0KCSAqIEByZXR1cm4gYm9vbHwgYXJyYXkNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFBhcmFtKCAkdGFnLCAkcGFyYW1fbmFtZSApIHsNCgkJaWYgKCAhIGlzc2V0KCBzZWxmOjokc2NbICR0YWcgXSApICkgew0KCQkJcmV0dXJuIHRyaWdnZXJfZXJyb3IoIHNwcmludGYoIF9fKCAiV3JvbmcgbmFtZSBmb3Igc2hvcnRjb2RlOiVzLiBOYW1lIHJlcXVpcmVkIiwgImpzX2NvbXBvc2VyIiApLCAkdGFnICkgKTsNCgkJfQ0KCQlmb3JlYWNoICggc2VsZjo6JHNjWyAkdGFnIF1bJ3BhcmFtcyddIGFzICRpbmRleCA9PiAkcGFyYW0gKSB7DQoJCQlpZiAoICRwYXJhbVsncGFyYW1fbmFtZSddID09ICRwYXJhbV9uYW1lICkgew0KCQkJCXJldHVybiBzZWxmOjokc2NbICR0YWcgXVsncGFyYW1zJ11bICRpbmRleCBdOw0KCQkJfQ0KCQl9DQoNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCg0KCS8qKg0KCSAqIEFkZCBuZXcgcGFyYW0gdG8gc2hvcnRjb2RlIHBhcmFtcyBsaXN0Lg0KCSAqDQoJICogQHN0YXRpYw0KCSAqDQoJICogQHBhcmFtICRuYW1lDQoJICogQHBhcmFtIGFycmF5ICRhdHRyaWJ1dGUNCgkgKg0KCSAqIEByZXR1cm4gYm9vbCAtIHRydWUgaWYgYWRkZWQsIGZhbHNlIGlmIHNjaGVkdWxlZC9yZWplY3RlZA0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gYWRkUGFyYW0oICRuYW1lLCAkYXR0cmlidXRlID0gQXJyYXkoKSApIHsNCgkJaWYgKCAhIHNlbGY6OiRpc19pbml0ICkgew0KCQkJdmNfbWFwcGVyKCktPmFkZEFjdGl2aXR5KA0KCQkJCSdtYXBwZXInLCAnYWRkX3BhcmFtJywgYXJyYXkoDQoJCQkJCSduYW1lJyA9PiAkbmFtZSwNCgkJCQkJJ2F0dHJpYnV0ZScgPT4gJGF0dHJpYnV0ZQ0KCQkJCSkNCgkJCSk7DQoNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCQlpZiAoICEgaXNzZXQoIHNlbGY6OiRzY1sgJG5hbWUgXSApICkgew0KCQkJdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICJXcm9uZyBuYW1lIGZvciBzaG9ydGNvZGU6JXMuIE5hbWUgcmVxdWlyZWQiLCAianNfY29tcG9zZXIiICksICRuYW1lICkgKTsNCgkJfSBlbHNlaWYgKCAhIGlzc2V0KCAkYXR0cmlidXRlWydwYXJhbV9uYW1lJ10gKSApIHsNCgkJCXRyaWdnZXJfZXJyb3IoIHNwcmludGYoIF9fKCAiV3JvbmcgYXR0cmlidXRlIGZvciAnJXMnIHNob3J0Y29kZS4gQXR0cmlidXRlICdwYXJhbV9uYW1lJyByZXF1aXJlZCIsICJqc19jb21wb3NlciIgKSwgJG5hbWUgKSApOw0KCQl9IGVsc2Ugew0KDQoJCQkkcmVwbGFjZWQgPSBmYWxzZTsNCg0KCQkJZm9yZWFjaCAoIHNlbGY6OiRzY1sgJG5hbWUgXVsncGFyYW1zJ10gYXMgJGluZGV4ID0+ICRwYXJhbSApIHsNCgkJCQlpZiAoICRwYXJhbVsncGFyYW1fbmFtZSddID09ICRhdHRyaWJ1dGVbJ3BhcmFtX25hbWUnXSApIHsNCgkJCQkJJHJlcGxhY2VkID0gdHJ1ZTsNCgkJCQkJc2VsZjo6JHNjWyAkbmFtZSBdWydwYXJhbXMnXVsgJGluZGV4IF0gPSAkYXR0cmlidXRlOw0KCQkJCX0NCgkJCX0NCgkJCWlmICggJHJlcGxhY2VkID09PSBmYWxzZSApIHsNCgkJCQlzZWxmOjokc2NbICRuYW1lIF1bJ3BhcmFtcyddW10gPSAkYXR0cmlidXRlOw0KCQkJfQ0KCQkJLyoNCgkJCSRzb3J0ID0gbmV3IFZjX1NvcnQoIHNlbGY6OiRzY1sgJG5hbWUgXVsncGFyYW1zJ10gKTsNCgkJCXNlbGY6OiRzY1sgJG5hbWUgXVsncGFyYW1zJ10gPSAkc29ydC0+c29ydEJ5S2V5KCk7DQoJCQkqLw0KCQkJdmlzdWFsX2NvbXBvc2VyKCktPmFkZFNob3J0Q29kZSggc2VsZjo6JHNjWyAkbmFtZSBdICk7DQoNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCg0KCS8qKg0KCSAqIENoYW5nZSBwYXJhbSBhdHRyaWJ1dGVzIG9mIG1hcHBlZCBzaG9ydGNvZGUuDQoJICoNCgkgKiBAc3RhdGljDQoJICoNCgkgKiBAcGFyYW0gJG5hbWUNCgkgKiBAcGFyYW0gYXJyYXkgJGF0dHJpYnV0ZQ0KCSAqDQoJICogQHJldHVybiBib29sDQoJICovDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBtdXRhdGVQYXJhbSggJG5hbWUsICRhdHRyaWJ1dGUgPSBBcnJheSgpICkgew0KCQlpZiAoICEgc2VsZjo6JGlzX2luaXQgKSB7DQoJCQl2Y19tYXBwZXIoKS0+YWRkQWN0aXZpdHkoDQoJCQkJJ21hcHBlcicsICdtdXRhdGVfcGFyYW0nLCBhcnJheSgNCgkJCQkJJ25hbWUnID0+ICRuYW1lLA0KCQkJCQknYXR0cmlidXRlJyA9PiAkYXR0cmlidXRlDQoJCQkJKQ0KCQkJKTsNCg0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJCWlmICggISBpc3NldCggc2VsZjo6JHNjWyAkbmFtZSBdICkgKSB7DQoJCQlyZXR1cm4gdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICJXcm9uZyBuYW1lIGZvciBzaG9ydGNvZGU6JXMuIE5hbWUgcmVxdWlyZWQiLCAianNfY29tcG9zZXIiICksICRuYW1lICkgKTsNCgkJfSBlbHNlaWYgKCAhIGlzc2V0KCAkYXR0cmlidXRlWydwYXJhbV9uYW1lJ10gKSApIHsNCgkJCXRyaWdnZXJfZXJyb3IoIHNwcmludGYoIF9fKCAiV3JvbmcgYXR0cmlidXRlIGZvciAnJXMnIHNob3J0Y29kZS4gQXR0cmlidXRlICdwYXJhbV9uYW1lJyByZXF1aXJlZCIsICJqc19jb21wb3NlciIgKSwgJG5hbWUgKSApOw0KCQl9IGVsc2Ugew0KDQoJCQkkcmVwbGFjZWQgPSBmYWxzZTsNCg0KCQkJZm9yZWFjaCAoIHNlbGY6OiRzY1sgJG5hbWUgXVsncGFyYW1zJ10gYXMgJGluZGV4ID0+ICRwYXJhbSApIHsNCgkJCQlpZiAoICRwYXJhbVsncGFyYW1fbmFtZSddID09ICRhdHRyaWJ1dGVbJ3BhcmFtX25hbWUnXSApIHsNCgkJCQkJJHJlcGxhY2VkID0gdHJ1ZTsNCgkJCQkJc2VsZjo6JHNjWyAkbmFtZSBdWydwYXJhbXMnXVsgJGluZGV4IF0gPSBhcnJheV9tZXJnZSggJHBhcmFtLCAkYXR0cmlidXRlICk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlpZiAoICRyZXBsYWNlZCA9PT0gZmFsc2UgKSB7DQoJCQkJc2VsZjo6JHNjWyAkbmFtZSBdWydwYXJhbXMnXVtdID0gJGF0dHJpYnV0ZTsNCgkJCX0NCgkJCSRzb3J0ID0gbmV3IFZjX1NvcnQoIHNlbGY6OiRzY1sgJG5hbWUgXVsncGFyYW1zJ10gKTsNCgkJCXNlbGY6OiRzY1sgJG5hbWUgXVsncGFyYW1zJ10gPSAkc29ydC0+c29ydEJ5S2V5KCk7DQoJCQl2aXN1YWxfY29tcG9zZXIoKS0+YWRkU2hvcnRDb2RlKCBzZWxmOjokc2NbICRuYW1lIF0gKTsNCgkJfQ0KDQoJCXJldHVybiB0cnVlOw0KCX0NCg0KCS8qKg0KCSAqIFJlbW92ZXMgc2hvcnRjb2RlIGZyb20gbWFwcGluZyBsaXN0Lg0KCSAqDQoJICogQHN0YXRpYw0KCSAqDQoJICogQHBhcmFtICRuYW1lDQoJICoNCgkgKiBAcmV0dXJuIGJvb2wNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGRyb3BTaG9ydGNvZGUoICRuYW1lICkgew0KCQlpZiAoICEgc2VsZjo6JGlzX2luaXQgKSB7DQoJCQl2Y19tYXBwZXIoKS0+YWRkQWN0aXZpdHkoDQoJCQkJJ21hcHBlcicsICdkcm9wX3Nob3J0Y29kZScsIGFycmF5KA0KCQkJCQknbmFtZScgPT4gJG5hbWUNCgkJCQkpDQoJCQkpOw0KDQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCgkJdW5zZXQoIHNlbGY6OiRzY1sgJG5hbWUgXSApOw0KCQl2aXN1YWxfY29tcG9zZXIoKS0+cmVtb3ZlU2hvcnRDb2RlKCAkbmFtZSApOw0KDQoJCXJldHVybiB0cnVlOw0KCX0NCg0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZHJvcEFsbFNob3J0Y29kZXMoKSB7DQoJCWlmICggISBzZWxmOjokaXNfaW5pdCApIHsNCgkJCXZjX21hcHBlcigpLT5hZGRBY3Rpdml0eSgNCgkJCQknbWFwcGVyJywgJ2Ryb3BfYWxsX3Nob3J0Y29kZXMnLCBhcnJheSgpDQoJCQkpOw0KDQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCgkJZm9yZWFjaCAoIHNlbGY6OiRzYyBhcyAkbmFtZSA9PiAkZGF0YSApIHsNCgkJCXZpc3VhbF9jb21wb3NlcigpLT5yZW1vdmVTaG9ydENvZGUoICRuYW1lICk7DQoJCX0NCgkJc2VsZjo6JHNjID0gYXJyYXkoKTsNCgkJc2VsZjo6JHVzZXJfc2MgPSBzZWxmOjokdXNlcl9jYXRlZ29yaWVzID0gc2VsZjo6JHVzZXJfc29ydGVkX3NjID0gZmFsc2U7DQoNCgkJcmV0dXJuIHRydWU7DQoJfQ0KDQoJLyoqDQoJICogTW9kaWZ5IHNob3J0Y29kZSdzIG1hcHBlZCBzZXR0aW5ncy4NCgkgKiBZb3UgY2FuIG1vZGlmeSBvbmx5IG9uZSBvcHRpb24gb2YgdGhlIGdyb3VwIG9wdGlvbnMuDQoJICogQ2FsbCB0aGlzIG1ldGhvZCB3aXRoICRzZXR0aW5nc19uYW1lIHBhcmFtIGFzIGFzc29jaWF0ZWQgYXJyYXkgdG8gbWFzcyBtb2RpZmljYXRpb25zLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqDQoJICogQHBhcmFtICRuYW1lIC0gc2hvcnRjb2RlJyBuYW1lLg0KCSAqIEBwYXJhbSAkc2V0dGluZ19uYW1lIC0gb3B0aW9uIGtleSBuYW1lIG9yIHRoZSBhcnJheSBvZiBvcHRpb25zLg0KCSAqIEBwYXJhbSAkdmFsdWUgLSB2YWx1ZSBvZiBzZXR0aW5ncyBpZiAkc2V0dGluZ19uYW1lIGlzIG9wdGlvbiBrZXkuDQoJICoNCgkgKiBAcmV0dXJuIGFycmF5fGJvb2wNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG1vZGlmeSggJG5hbWUsICRzZXR0aW5nX25hbWUsICR2YWx1ZSA9ICcnICkgew0KCQlpZiAoICEgc2VsZjo6JGlzX2luaXQgKSB7DQoJCQl2Y19tYXBwZXIoKS0+YWRkQWN0aXZpdHkoDQoJCQkJJ21hcHBlcicsICdtb2RpZnknLCBhcnJheSgNCgkJCQkJJ25hbWUnID0+ICRuYW1lLA0KCQkJCQknc2V0dGluZ19uYW1lJyA9PiAkc2V0dGluZ19uYW1lLA0KCQkJCQkndmFsdWUnID0+ICR2YWx1ZQ0KCQkJCSkNCgkJCSk7DQoNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCQlpZiAoICEgaXNzZXQoIHNlbGY6OiRzY1sgJG5hbWUgXSApICkgew0KCQkJcmV0dXJuIHRyaWdnZXJfZXJyb3IoIHNwcmludGYoIF9fKCAiV3JvbmcgbmFtZSBmb3Igc2hvcnRjb2RlOiVzLiBOYW1lIHJlcXVpcmVkIiwgImpzX2NvbXBvc2VyIiApLCAkbmFtZSApICk7DQoJCX0gZWxzZWlmICggJHNldHRpbmdfbmFtZSA9PT0gJ2Jhc2UnICkgew0KCQkJcmV0dXJuIHRyaWdnZXJfZXJyb3IoIHNwcmludGYoIF9fKCAiV3Jvbmcgc2V0dGluZ19uYW1lIGZvciBzaG9ydGNvZGU6JXMuIEJhc2UgY2FuJ3QgYmUgbW9kaWZpZWQuIiwgImpzX2NvbXBvc2VyIiApLCAkbmFtZSApICk7DQoJCX0NCgkJaWYgKCBpc19hcnJheSggJHNldHRpbmdfbmFtZSApICkgew0KCQkJZm9yZWFjaCAoICRzZXR0aW5nX25hbWUgYXMgJGtleSA9PiAkdmFsdWUgKSB7DQoJCQkJc2VsZjo6bW9kaWZ5KCAkbmFtZSwgJGtleSwgJHZhbHVlICk7DQoJCQl9DQoJCX0gZWxzZSB7DQoJCQlzZWxmOjokc2NbICRuYW1lIF1bICRzZXR0aW5nX25hbWUgXSA9ICR2YWx1ZTsNCgkJCXZpc3VhbF9jb21wb3NlcigpLT51cGRhdGVTaG9ydGNvZGVTZXR0aW5nKCAkbmFtZSwgJHNldHRpbmdfbmFtZSwgJHZhbHVlICk7DQoJCX0NCg0KCQlyZXR1cm4gc2VsZjo6JHNjOw0KCX0NCg0KCS8qKg0KCSAqIFJldHVybnMgInwiIHNlcGFyYXRlZCBsaXN0IG9mIG1hcHBlZCBzaG9ydGNvZGUgdGFncy4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKiBAcmV0dXJuIHN0cmluZw0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0VGFnc1JlZ2V4cCgpIHsNCgkJaWYgKCBlbXB0eSggc2VsZjo6JHRhZ3NfcmVnZXhwICkgKSB7DQoJCQlzZWxmOjokdGFnc19yZWdleHAgPSBpbXBsb2RlKCAnfCcsIGFycmF5X2tleXMoIHNlbGY6OiRzYyApICk7DQoJCX0NCg0KCQlyZXR1cm4gc2VsZjo6JHRhZ3NfcmVnZXhwOw0KCX0NCg0KCS8qKg0KCSAqIFNvcnRpbmcgbWV0aG9kIGZvciBXUEJNYXA6OmdlbmVyYXRlVXNlckRhdGEgbWV0aG9kLiBDYWxsZWQgYnkgdXNvcnQgcGhwIGZ1bmN0aW9uLg0KCSAqIEBkZXByZWNhdGVkIC0gdXNlIFZjX1NvcnQ6OnNvcnRCeUtleSBzaW5jZSA0LjQNCgkgKiBAc3RhdGljDQoJICoNCgkgKiBAcGFyYW0gJGENCgkgKiBAcGFyYW0gJGINCgkgKg0KCSAqIEByZXR1cm4gaW50DQoJICovDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBzb3J0KCAkYSwgJGIgKSB7DQoJCSRhX3dlaWdodCA9IGlzc2V0KCAkYVsnd2VpZ2h0J10gKSA/IChpbnQpICRhWyd3ZWlnaHQnXSA6IDA7DQoJCSRiX3dlaWdodCA9IGlzc2V0KCAkYlsnd2VpZ2h0J10gKSA/IChpbnQpICRiWyd3ZWlnaHQnXSA6IDA7DQoJCWlmICggJGFfd2VpZ2h0ID09ICRiX3dlaWdodCApIHsNCgkJCSRjbXBhID0gYXJyYXlfc2VhcmNoKCAkYSwgc2VsZjo6JHVzZXJfc29ydGVkX3NjICk7DQoJCQkkY21wYiA9IGFycmF5X3NlYXJjaCggJGIsIHNlbGY6OiR1c2VyX3NvcnRlZF9zYyApOw0KDQoJCQlyZXR1cm4gKCAkY21wYSA+ICRjbXBiICkgPyAxIDogLSAxOw0KCQl9DQoNCgkJcmV0dXJuICggJGFfd2VpZ2h0IDwgJGJfd2VpZ2h0ICkgPyAxIDogLSAxOw0KCX0NCn0NCg==',
	'include/classes/shortcodes/shortcodes.php' => 'PD9waHANCi8qKg0KICogV1BCYWtlcnkgVmlzdWFsIENvbXBvc2VyIFNob3J0Y29kZXMgbWFpbg0KICoNCiAqIEBwYWNrYWdlIFdQQmFrZXJ5VmlzdWFsQ29tcG9zZXINCiAqDQogKi8NCg0KLyogYWJzdHJhY3QgVmlzdWFsQ29tcG9zZXIgY2xhc3MgdG8gY3JlYXRlIHN0cnVjdHVyYWwgb2JqZWN0IG9mIGFueSB0eXBlICovDQppZiAoICEgY2xhc3NfZXhpc3RzKCAnV1BCYWtlcnlWaXN1YWxDb21wb3NlckFic3RyYWN0JyApICkgew0KCS8qKg0KCSAqIENsYXNzIFdQQmFrZXJ5VmlzdWFsQ29tcG9zZXJBYnN0cmFjdA0KCSAqLw0KCWFic3RyYWN0IGNsYXNzIFdQQmFrZXJ5VmlzdWFsQ29tcG9zZXJBYnN0cmFjdCB7DQoJCS8qKg0KCQkgKiBAdmFyDQoJCSAqLw0KCQlwdWJsaWMgc3RhdGljICRjb25maWc7DQoJCS8qKg0KCQkgKiBAdmFyIGJvb2wNCgkJICovDQoJCXByb3RlY3RlZCAkaXNfcGx1Z2luID0gdHJ1ZTsNCgkJLyoqDQoJCSAqIEB2YXIgYm9vbA0KCQkgKi8NCgkJcHJvdGVjdGVkICRpc190aGVtZSA9IGZhbHNlOw0KCQkvKioNCgkJICogQHZhciBib29sDQoJCSAqLw0KCQlwcm90ZWN0ZWQgJGRpc2FibGVfdXBkYXRlciA9IGZhbHNlOw0KCQkvKioNCgkJICogQHZhciBib29sDQoJCSAqLw0KCQlwcm90ZWN0ZWQgJHNldHRpbmdzX2FzX3RoZW1lID0gZmFsc2U7DQoJCS8qKg0KCQkgKiBAdmFyIGJvb2wNCgkJICovDQoJCXByb3RlY3RlZCAkYXNfbmV0d29ya19wbHVnaW4gPSBmYWxzZTsNCgkJLyoqDQoJCSAqIEB2YXIgYm9vbA0KCQkgKi8NCgkJcHJvdGVjdGVkICRpc19pbml0ID0gZmFsc2U7DQoJCS8qKg0KCQkgKiBAdmFyIHN0cmluZw0KCQkgKi8NCgkJcHJvdGVjdGVkICRjb250cm9sc19jc3Nfc2V0dGluZ3MgPSAnY2MnOw0KCQkvKioNCgkJICogQHZhciBhcnJheQ0KCQkgKi8NCgkJcHJvdGVjdGVkICRjb250cm9sc19saXN0ID0gYXJyYXkoICdlZGl0JywgJ2Nsb25lJywgJ2RlbGV0ZScgKTsNCg0KCQkvKioNCgkJICogQHZhciBzdHJpbmcNCgkJICovDQoJCXByb3RlY3RlZCAkc2hvcnRjb2RlX2NvbnRlbnQgPSAnJzsNCg0KCQkvKioNCgkJICoNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgpIHsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJHNldHRpbmdzDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gaW5pdCggJHNldHRpbmdzICkgew0KCQkJc2VsZjo6JGNvbmZpZyA9IChhcnJheSkgJHNldHRpbmdzOw0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkYWN0aW9uDQoJCSAqIEBwYXJhbSAkbWV0aG9kDQoJCSAqIEBwYXJhbSBpbnQgJHByaW9yaXR5DQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gYWRkQWN0aW9uKCAkYWN0aW9uLCAkbWV0aG9kLCAkcHJpb3JpdHkgPSAxMCApIHsNCgkJCWFkZF9hY3Rpb24oICRhY3Rpb24sIGFycmF5KCAmJHRoaXMsICRtZXRob2QgKSwgJHByaW9yaXR5ICk7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRhY3Rpb24NCgkJICogQHBhcmFtICRtZXRob2QNCgkJICogQHBhcmFtIGludCAkcHJpb3JpdHkNCgkJICoNCgkJICogQHJldHVybiBib29sDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gcmVtb3ZlQWN0aW9uKCAkYWN0aW9uLCAkbWV0aG9kLCAkcHJpb3JpdHkgPSAxMCApIHsNCgkJCXJldHVybiByZW1vdmVfYWN0aW9uKCAkYWN0aW9uLCBhcnJheSggJHRoaXMsICRtZXRob2QgKSwgJHByaW9yaXR5ICk7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRmaWx0ZXINCgkJICogQHBhcmFtICRtZXRob2QNCgkJICogQHBhcmFtIGludCAkcHJpb3JpdHkNCgkJICoNCgkJICogQHJldHVybiBib29sfHZvaWQNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBhZGRGaWx0ZXIoICRmaWx0ZXIsICRtZXRob2QsICRwcmlvcml0eSA9IDEwICkgew0KCQkJcmV0dXJuIGFkZF9maWx0ZXIoICRmaWx0ZXIsIGFycmF5KCAmJHRoaXMsICRtZXRob2QgKSwgJHByaW9yaXR5ICk7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRmaWx0ZXINCgkJICogQHBhcmFtICRtZXRob2QNCgkJICogQHBhcmFtIGludCAkcHJpb3JpdHkNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiByZW1vdmVGaWx0ZXIoICRmaWx0ZXIsICRtZXRob2QsICRwcmlvcml0eSA9IDEwICkgew0KCQkJcmVtb3ZlX2ZpbHRlciggJGZpbHRlciwgYXJyYXkoICYkdGhpcywgJG1ldGhvZCApLCAkcHJpb3JpdHkgKTsNCgkJfQ0KDQoJCS8qIFNob3J0Y29kZSBtZXRob2RzICovDQoJCS8qKg0KCQkgKiBAcGFyYW0gJHRhZw0KCQkgKiBAcGFyYW0gJGZ1bmMNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBhZGRTaG9ydENvZGUoICR0YWcsICRmdW5jICkgew0KCQkJYWRkX3Nob3J0Y29kZSggJHRhZywgJGZ1bmMgKTsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJGNvbnRlbnQNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBkb1Nob3J0Q29kZSggJGNvbnRlbnQgKSB7DQoJCQlkb19zaG9ydGNvZGUoICRjb250ZW50ICk7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICR0YWcNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiByZW1vdmVTaG9ydENvZGUoICR0YWcgKSB7DQoJCQlyZW1vdmVfc2hvcnRjb2RlKCAkdGFnICk7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRwYXJhbQ0KCQkgKg0KCQkgKiBAcmV0dXJuIG51bGwNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBwb3N0KCAkcGFyYW0gKSB7DQoJCQlyZXR1cm4gaXNzZXQoICRfUE9TVFsgJHBhcmFtIF0gKSA/ICRfUE9TVFsgJHBhcmFtIF0gOiBudWxsOw0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkcGFyYW0NCgkJICoNCgkJICogQHJldHVybiBudWxsDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gZ2V0KCAkcGFyYW0gKSB7DQoJCQlyZXR1cm4gaXNzZXQoICRfR0VUWyAkcGFyYW0gXSApID8gJF9HRVRbICRwYXJhbSBdIDogbnVsbDsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAZGVwcmVjYXRlZA0KCQkgKg0KCQkgKiBAcGFyYW0gJGFzc2V0DQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gYXNzZXRVUkwoICRhc3NldCApIHsNCgkJCXJldHVybiB2Y19hc3NldF91cmwoICRhc3NldCApOw0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkYXNzZXQNCgkJICoNCgkJICogQHJldHVybiBzdHJpbmcNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBhc3NldFBhdGgoICRhc3NldCApIHsNCgkJCXJldHVybiBzZWxmOjokY29uZmlnWydBUFBfUk9PVCddIC4gc2VsZjo6JGNvbmZpZ1snQVNTRVRTX0RJUiddIC4gJGFzc2V0Ow0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkbmFtZQ0KCQkgKg0KCQkgKiBAcmV0dXJuIG51bGwNCgkJICovDQoJCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gY29uZmlnKCAkbmFtZSApIHsNCgkJCXJldHVybiBpc3NldCggc2VsZjo6JGNvbmZpZ1sgJG5hbWUgXSApID8gc2VsZjo6JGNvbmZpZ1sgJG5hbWUgXSA6IG51bGw7DQoJCX0NCgl9DQp9DQoNCi8qKg0KICoNCiAqLw0KZGVmaW5lKCAnVkNfU0hPUlRDT0RFX0NVU1RPTUlaRV9QUkVGSVgnLCAndmNfdGhlbWVfJyApOw0KLyoqDQogKg0KICovDQpkZWZpbmUoICdWQ19TSE9SVENPREVfQkVGT1JFX0NVU1RPTUlaRV9QUkVGSVgnLCAndmNfdGhlbWVfYmVmb3JlXycgKTsNCi8qKg0KICoNCiAqLw0KZGVmaW5lKCAnVkNfU0hPUlRDT0RFX0FGVEVSX0NVU1RPTUlaRV9QUkVGSVgnLCAndmNfdGhlbWVfYWZ0ZXJfJyApOw0KLyoqDQogKg0KICovDQpkZWZpbmUoICdWQ19TSE9SVENPREVfQ1VTVE9NX0NTU19GSUxURVJfVEFHJywgJ3ZjX3Nob3J0Y29kZXNfY3NzX2NsYXNzJyApOw0KaWYgKCAhIGNsYXNzX2V4aXN0cyggJ1dQQmFrZXJ5U2hvcnRDb2RlJyApICkgew0KCS8qKg0KCSAqIENsYXNzIFdQQmFrZXJ5U2hvcnRDb2RlDQoJICovDQoJYWJzdHJhY3QgY2xhc3MgV1BCYWtlcnlTaG9ydENvZGUgZXh0ZW5kcyBXUEJha2VyeVZpc3VhbENvbXBvc2VyQWJzdHJhY3Qgew0KDQoJCS8qKg0KCQkgKiBAdmFyDQoJCSAqLw0KCQlwcm90ZWN0ZWQgJHNob3J0Y29kZTsNCgkJLyoqDQoJCSAqIEB2YXINCgkJICovDQoJCXByb3RlY3RlZCAkaHRtbF90ZW1wbGF0ZTsNCg0KCQkvKioNCgkJICogQHZhcg0KCQkgKi8NCgkJLyoqDQoJCSAqIEB2YXINCgkJICovDQoJCXByb3RlY3RlZCAkYXR0cywgJHNldHRpbmdzOw0KCQkvKioNCgkJICogQHZhciBpbnQNCgkJICovDQoJCXByb3RlY3RlZCBzdGF0aWMgJGVucXVldWVfaW5kZXggPSAwOw0KCQkvKioNCgkJICogQHZhciBhcnJheQ0KCQkgKi8NCgkJcHJvdGVjdGVkIHN0YXRpYyAkanNfc2NyaXB0cyA9IGFycmF5KCk7DQoJCS8qKg0KCQkgKiBAdmFyIGFycmF5DQoJCSAqLw0KCQlwcm90ZWN0ZWQgc3RhdGljICRjc3Nfc2NyaXB0cyA9IGFycmF5KCk7DQoJCS8qKg0KCQkgKiBkZWZhdWx0IHNjcmlwdHMgbGlrZSBzY3JpcHRzDQoJCSAqIEB2YXIgYm9vbA0KCQkgKiBAc2luY2UgNC40LjMNCgkJICovDQoJCXByb3RlY3RlZCBzdGF0aWMgJGRlZmF1bHRfc2NyaXB0c19lbnF1ZXVlZCA9IGZhbHNlOw0KCQkvKioNCgkJICogQHZhciBzdHJpbmcNCgkJICovDQoJCXByb3RlY3RlZCAkc2hvcnRjb2RlX3N0cmluZyA9ICcnOw0KCQkvKioNCgkJICogQHZhciBzdHJpbmcNCgkJICovDQoJCXByb3RlY3RlZCAkY29udHJvbHNfdGVtcGxhdGVfZmlsZSA9ICdlZGl0b3JzL3BhcnRpYWxzL2JhY2tlbmRfY29udHJvbHMudHBsLnBocCc7DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkc2V0dGluZ3MNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCggJHNldHRpbmdzICkgew0KCQkJJHRoaXMtPnNldHRpbmdzID0gJHNldHRpbmdzOw0KCQkJJHRoaXMtPnNob3J0Y29kZSA9ICR0aGlzLT5zZXR0aW5nc1snYmFzZSddOw0KDQoJCQkkdGhpcy0+YWRkQWN0aW9uKCAnYWRtaW5faW5pdCcsICdlbnF1ZXVlQXNzZXRzJyApOw0KCQkJJHRoaXMtPmFkZEFjdGlvbiggJ2FkbWluX2hlYWQnLCAncHJpbnRJY29uU3R5bGVzJyApOw0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkY29udGVudA0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGFkZElubGluZUFuY2hvcnMoICRjb250ZW50ICkgew0KCQkJcmV0dXJuICggJHRoaXMtPmlzSW5saW5lKCkgfHwgJHRoaXMtPmlzRWRpdG9yKCkgJiYgJHRoaXMtPnNldHRpbmdzKCAnaXNfY29udGFpbmVyJyApID09PSB0cnVlID8gJzxzcGFuIGNsYXNzPSJ2Y19jb250YWluZXItYW5jaG9yIj48L3NwYW4+JyA6ICcnICkgLiAkY29udGVudDsNCgkJfQ0KDQoJCS8qKg0KCQkgKg0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGVucXVldWVBc3NldHMoKSB7DQoJCQlpZiAoICEgZW1wdHkoICR0aGlzLT5zZXR0aW5nc1snYWRtaW5fZW5xdWV1ZV9qcyddICkgKSB7DQoJCQkJJHRoaXMtPnJlZ2lzdGVySnMoICR0aGlzLT5zZXR0aW5nc1snYWRtaW5fZW5xdWV1ZV9qcyddICk7DQoJCQl9DQoJCQlpZiAoICEgZW1wdHkoICR0aGlzLT5zZXR0aW5nc1snYWRtaW5fZW5xdWV1ZV9jc3MnXSApICkgew0KCQkJCSR0aGlzLT5yZWdpc3RlckNzcyggJHRoaXMtPnNldHRpbmdzWydhZG1pbl9lbnF1ZXVlX2NzcyddICk7DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJICogUHJpbnRzIG91dCB0aGUgc3R5bGVzIG5lZWRlZCB0byByZW5kZXIgdGhlIGVsZW1lbnQgaWNvbiBmb3IgdGhlIGJhY2sgZW5kIGludGVyZmFjZS4NCgkJICogT25seSBwZXJmb3JtZWQgaWYgdGhlICdpY29uJyBzZXR0aW5nIGlzIGEgdmFsaWQgVVJMLg0KCQkgKg0KCQkgKiBAcmV0dXJuIHZvaWQNCgkJICogQHNpbmNlICA0LjINCgkJICogQG1vZGlmaWVkIDQuNA0KCQkgKiBAYXV0aG9yIEJlbmphbWluIEludGFsDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gcHJpbnRJY29uU3R5bGVzKCkgew0KCQkJaWYgKCAhIGZpbHRlcl92YXIoICR0aGlzLT5zZXR0aW5ncyggJ2ljb24nICksIEZJTFRFUl9WQUxJREFURV9VUkwgKSApIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoJCQllY2hvICINCiAgICAgICAgICAgIDxzdHlsZT4NCiAgICAgICAgICAgICAgICAudmNfZWwtY29udGFpbmVyICMiIC4gZXNjX2F0dHIoICR0aGlzLT5zZXR0aW5nc1snYmFzZSddICkgLiAiIC52Y19lbGVtZW50LWljb24sDQogICAgICAgICAgICAgICAgLndwYl8iIC4gZXNjX2F0dHIoICR0aGlzLT5zZXR0aW5nc1snYmFzZSddICkgLiAiIC53cGJfZWxlbWVudF90aXRsZSAudmNfZWxlbWVudC1pY29uLA0KICAgICAgICAgICAgICAgIC52Y19lbC1jb250YWluZXIgPiAjIiAuIGVzY19hdHRyKCAkdGhpcy0+c2V0dGluZ3NbJ2Jhc2UnXSApIC4gIiA+IC52Y19lbGVtZW50LWljb24sDQogICAgICAgICAgICAgICAgLnZjX2VsLWNvbnRhaW5lciA+ICMiIC4gZXNjX2F0dHIoICR0aGlzLT5zZXR0aW5nc1snYmFzZSddICkgLiAiID4gLnZjX2VsZW1lbnQtaWNvbltkYXRhLWlzLWNvbnRhaW5lcj1cInRydWVcIl0sDQogICAgICAgICAgICAgICAgLmNvbXBvc2VfbW9kZSAudmNfaGVscGVyLnZjX2hlbHBlci0iIC4gZXNjX2F0dHIoICR0aGlzLT5zZXR0aW5nc1snYmFzZSddICkgLiAiID4gLnZjX2VsZW1lbnQtaWNvbiwNCiAgICAgICAgICAgICAgICAudmNfaGVscGVyLnZjX2hlbHBlci0iIC4gZXNjX2F0dHIoICR0aGlzLT5zZXR0aW5nc1snYmFzZSddICkgLiAiID4gLnZjX2VsZW1lbnQtaWNvbiwNCiAgICAgICAgICAgICAgICAuY29tcG9zZV9tb2RlIC52Y19oZWxwZXIudmNfaGVscGVyLSIgLiBlc2NfYXR0ciggJHRoaXMtPnNldHRpbmdzWydiYXNlJ10gKSAuICIgPiAudmNfZWxlbWVudC1pY29uW2RhdGEtaXMtY29udGFpbmVyPVwidHJ1ZVwiXSwNCiAgICAgICAgICAgICAgICAudmNfaGVscGVyLnZjX2hlbHBlci0iIC4gZXNjX2F0dHIoICR0aGlzLT5zZXR0aW5nc1snYmFzZSddICkgLiAiID4gLnZjX2VsZW1lbnQtaWNvbltkYXRhLWlzLWNvbnRhaW5lcj1cInRydWVcIl0sDQogICAgICAgICAgICAgICAgLndwYl8iIC4gZXNjX2F0dHIoICR0aGlzLT5zZXR0aW5nc1snYmFzZSddICkgLiAiID4gLndwYl9lbGVtZW50X3dyYXBwZXIgPiAud3BiX2VsZW1lbnRfdGl0bGUgPiAudmNfZWxlbWVudC1pY29uLA0KICAgICAgICAgICAgICAgIC53cGJfIiAuIGVzY19hdHRyKCAkdGhpcy0+c2V0dGluZ3NbJ2Jhc2UnXSApIC4gIiA+IC53cGJfZWxlbWVudF93cmFwcGVyID4gLndwYl9lbGVtZW50X3RpdGxlID4gLnZjX2VsZW1lbnQtaWNvbltkYXRhLWlzLWNvbnRhaW5lcj1cInRydWVcIl0gew0KICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIDA7DQogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiIC4gZXNjX3VybCggJHRoaXMtPnNldHRpbmdzWydpY29uJ10gKSAuICIpOw0KICAgICAgICAgICAgICAgICAgICAtd2Via2l0LWJhY2tncm91bmQtc2l6ZTogY29udGFpbjsNCiAgICAgICAgICAgICAgICAgICAgLW1vei1iYWNrZ3JvdW5kLXNpemU6IGNvbnRhaW47DQogICAgICAgICAgICAgICAgICAgIC1tcy1iYWNrZ3JvdW5kLXNpemU6IGNvbnRhaW47DQogICAgICAgICAgICAgICAgICAgIC1vLWJhY2tncm91bmQtc2l6ZTogY29udGFpbjsNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1zaXplOiBjb250YWluOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIDwvc3R5bGU+IjsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJHBhcmFtDQoJCSAqLw0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gcmVnaXN0ZXJKcyggJHBhcmFtICkgew0KCQkJaWYgKCBpc19hcnJheSggJHBhcmFtICkgJiYgISBlbXB0eSggJHBhcmFtICkgKSB7DQoJCQkJZm9yZWFjaCAoICRwYXJhbSBhcyAkdmFsdWUgKSB7DQoJCQkJCSR0aGlzLT5yZWdpc3RlckpzKCAkdmFsdWUgKTsNCgkJCQl9DQoJCQl9IGVsc2VpZiAoIGlzX3N0cmluZyggJHBhcmFtICkgJiYgISBlbXB0eSggJHBhcmFtICkgKSB7DQoJCQkJJG5hbWUgPSAnYWRtaW5fZW5xdWV1ZV9qc18nIC4gbWQ1KCAkcGFyYW0gKTsNCgkJCQlzZWxmOjokanNfc2NyaXB0c1tdID0gJG5hbWU7DQoJCQkJd3BfcmVnaXN0ZXJfc2NyaXB0KCAkbmFtZSwgJHBhcmFtLCBhcnJheSggJ2pxdWVyeScgKSwgV1BCX1ZDX1ZFUlNJT04sIHRydWUgKTsNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJHBhcmFtDQoJCSAqLw0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gcmVnaXN0ZXJDc3MoICRwYXJhbSApIHsNCgkJCWlmICggaXNfYXJyYXkoICRwYXJhbSApICYmICEgZW1wdHkoICRwYXJhbSApICkgew0KCQkJCWZvcmVhY2ggKCAkcGFyYW0gYXMgJHZhbHVlICkgew0KCQkJCQkkdGhpcy0+cmVnaXN0ZXJDc3MoICR2YWx1ZSApOw0KCQkJCX0NCgkJCX0gZWxzZWlmICggaXNfc3RyaW5nKCAkcGFyYW0gKSAmJiAhIGVtcHR5KCAkcGFyYW0gKSApIHsNCgkJCQkkbmFtZSA9ICdhZG1pbl9lbnF1ZXVlX2Nzc18nIC4gbWQ1KCAkcGFyYW0gKTsNCgkJCQlzZWxmOjokY3NzX3NjcmlwdHNbXSA9ICRuYW1lOw0KCQkJCXdwX3JlZ2lzdGVyX3N0eWxlKCAkbmFtZSwgJHBhcmFtLCBhcnJheSggJ2pzX2NvbXBvc2VyJyApLCBXUEJfVkNfVkVSU0lPTiApOw0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSAqDQoJCSAqLw0KCQlwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGVucXVldWVDc3MoKSB7DQoJCQlpZiAoICEgZW1wdHkoIHNlbGY6OiRjc3Nfc2NyaXB0cyApICkgew0KCQkJCWZvcmVhY2ggKCBzZWxmOjokY3NzX3NjcmlwdHMgYXMgJHN0eWxlc2hlZXQgKSB7DQoJCQkJCXdwX2VucXVldWVfc3R5bGUoICRzdHlsZXNoZWV0ICk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSAqDQoJCSAqLw0KCQlwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGVucXVldWVKcygpIHsNCgkJCWlmICggISBlbXB0eSggc2VsZjo6JGpzX3NjcmlwdHMgKSApIHsNCgkJCQlmb3JlYWNoICggc2VsZjo6JGpzX3NjcmlwdHMgYXMgJHNjcmlwdCApIHsNCgkJCQkJd3BfZW5xdWV1ZV9zY3JpcHQoICRzY3JpcHQgKTsNCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRzaG9ydGNvZGUNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBzaG9ydGNvZGUoICRzaG9ydGNvZGUgKSB7DQoNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJHRlbXBsYXRlDQoJCSAqLw0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0VGVtcGxhdGUoICR0ZW1wbGF0ZSApIHsNCgkJCXJldHVybiAkdGhpcy0+aHRtbF90ZW1wbGF0ZSA9IGFwcGx5X2ZpbHRlcnMoICd2Y19zaG9ydGNvZGVfc2V0X3RlbXBsYXRlXycgLiAkdGhpcy0+c2hvcnRjb2RlLCAkdGVtcGxhdGUgKTsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcmV0dXJuIGJvb2wNCgkJICovDQoJCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRUZW1wbGF0ZSgpIHsNCgkJCWlmICggaXNzZXQoICR0aGlzLT5odG1sX3RlbXBsYXRlICkgKSB7DQoJCQkJcmV0dXJuICR0aGlzLT5odG1sX3RlbXBsYXRlOw0KCQkJfQ0KDQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCg0KCQkvKioNCgkJICogQHJldHVybiBtaXhlZA0KCQkgKi8NCgkJcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEZpbGVOYW1lKCkgew0KCQkJcmV0dXJuICR0aGlzLT5zaG9ydGNvZGU7DQoJCX0NCg0KCQkvKioNCgkJICogRmluZCBodG1sIHRlbXBsYXRlIGZvciBzaG9ydGNvZGUgb3V0cHV0Lg0KCQkgKi8NCgkJcHJvdGVjdGVkIGZ1bmN0aW9uIGZpbmRTaG9ydGNvZGVUZW1wbGF0ZSgpIHsNCgkJCS8vIENoZWNrIHRlbXBsYXRlIHBhdGggaW4gc2hvcnRjb2RlJ3MgbWFwcGluZyBzZXR0aW5ncw0KCQkJaWYgKCAhIGVtcHR5KCAkdGhpcy0+c2V0dGluZ3NbJ2h0bWxfdGVtcGxhdGUnXSApICYmIGlzX2ZpbGUoICR0aGlzLT5zZXR0aW5ncyggJ2h0bWxfdGVtcGxhdGUnICkgKSApIHsNCgkJCQlyZXR1cm4gJHRoaXMtPnNldFRlbXBsYXRlKCAkdGhpcy0+c2V0dGluZ3NbJ2h0bWxfdGVtcGxhdGUnXSApOw0KCQkJfQ0KDQoJCQkvLyBDaGVjayB0ZW1wbGF0ZSBpbiB0aGVtZSBkaXJlY3RvcnkNCgkJCSR1c2VyX3RlbXBsYXRlID0gdmNfc2hvcnRjb2Rlc190aGVtZV90ZW1wbGF0ZXNfZGlyKCAkdGhpcy0+Z2V0RmlsZW5hbWUoKSAuICcucGhwJyApOw0KCQkJaWYgKCBpc19maWxlKCAkdXNlcl90ZW1wbGF0ZSApICkgew0KCQkJCXJldHVybiAkdGhpcy0+c2V0VGVtcGxhdGUoICR1c2VyX3RlbXBsYXRlICk7DQoJCQl9DQoNCgkJCS8vIENoZWNrIGRlZmF1bHQgcGxhY2UNCgkJCSRkZWZhdWx0X2RpciA9IHZjX21hbmFnZXIoKS0+Z2V0RGVmYXVsdFNob3J0Y29kZXNUZW1wbGF0ZXNEaXIoKSAuICcvJzsNCgkJCWlmICggaXNfZmlsZSggJGRlZmF1bHRfZGlyIC4gJHRoaXMtPmdldEZpbGVuYW1lKCkgLiAnLnBocCcgKSApIHsNCgkJCQlyZXR1cm4gJHRoaXMtPnNldFRlbXBsYXRlKCAkZGVmYXVsdF9kaXIgLiAkdGhpcy0+Z2V0RmlsZW5hbWUoKSAuICcucGhwJyApOw0KCQkJfQ0KDQoJCQlyZXR1cm4gJyc7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRhdHRzDQoJCSAqIEBwYXJhbSBudWxsICRjb250ZW50DQoJCSAqDQoJCSAqIEByZXR1cm4gbWl4ZWR8dm9pZA0KCQkgKi8NCgkJcHJvdGVjdGVkIGZ1bmN0aW9uIGNvbnRlbnQoICRhdHRzLCAkY29udGVudCA9IG51bGwgKSB7DQoJCQlyZXR1cm4gJHRoaXMtPmxvYWRUZW1wbGF0ZSggJGF0dHMsICRjb250ZW50ICk7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRhdHRzDQoJCSAqIEBwYXJhbSBudWxsICRjb250ZW50DQoJCSAqDQoJCSAqIHZjX2ZpbHRlcjogdmNfc2hvcnRjb2RlX2NvbnRlbnRfZmlsdGVyIC0gaG9vayB0byBlZGl0IHRlbXBsYXRlIGNvbnRlbnQNCgkJICogdmNfZmlsdGVyOiB2Y19zaG9ydGNvZGVfY29udGVudF9maWx0ZXJfYWZ0ZXIgLSBob29rIGFmdGVyIHRlbXBsYXRlIGlzIGxvYWRlZCB0byBvdmVycmlkZSBvdXRwdXQNCgkJICoNCgkJICogQHJldHVybiBtaXhlZHx2b2lkDQoJCSAqLw0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gbG9hZFRlbXBsYXRlKCAkYXR0cywgJGNvbnRlbnQgPSBudWxsICkgew0KDQoJCQkjIHN0YXJ0OiBtb2RpZmllZCBieSBBcmxpbmQgTnVzaGkNCiAgICAgICAgCWdsb2JhbCAkYXR0c192YWx1ZXM7DQogICAgICAgIAkkYXR0c192YWx1ZXMgPSAkYXR0czsNCiAgICAgICAgCSMgZW5kOiBtb2RpZmllZCBieSBBcmxpbmQgTnVzaGkNCiAgICAgICAgCQ0KCQkJJG91dHB1dCA9ICcnOw0KCQkJaWYgKCAhIGlzX251bGwoICRjb250ZW50ICkgKSB7DQoJCQkJJGNvbnRlbnQgPSBhcHBseV9maWx0ZXJzKCAndmNfc2hvcnRjb2RlX2NvbnRlbnRfZmlsdGVyJywgJGNvbnRlbnQsICR0aGlzLT5zaG9ydGNvZGUgKTsNCgkJCX0NCgkJCSR0aGlzLT5maW5kU2hvcnRjb2RlVGVtcGxhdGUoKTsNCgkJCWlmICggJHRoaXMtPmh0bWxfdGVtcGxhdGUgKSB7DQoJCQkJb2Jfc3RhcnQoKTsNCgkJCQlpbmNsdWRlKCAkdGhpcy0+aHRtbF90ZW1wbGF0ZSApOw0KCQkJCSRvdXRwdXQgPSBvYl9nZXRfY29udGVudHMoKTsNCgkJCQlvYl9lbmRfY2xlYW4oKTsNCgkJCX0gZWxzZSB7DQoJCQkJdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICdUZW1wbGF0ZSBmaWxlIGlzIG1pc3NpbmcgZm9yIGAlc2Agc2hvcnRjb2RlLiBNYWtlIHN1cmUgeW91IGhhdmUgYCVzYCBmaWxlIGluIHlvdXIgdGhlbWUgZm9sZGVyLicsICdqc19jb21wb3NlcicgKSwgJHRoaXMtPnNob3J0Y29kZSwgJ3dwLWNvbnRlbnQvdGhlbWVzL3lvdXJfdGhlbWUvdmNfdGVtcGxhdGVzLycgLiAkdGhpcy0+c2hvcnRjb2RlIC4gJy5waHAnICkgKTsNCgkJCX0NCg0KCQkJcmV0dXJuIGFwcGx5X2ZpbHRlcnMoICd2Y19zaG9ydGNvZGVfY29udGVudF9maWx0ZXJfYWZ0ZXInLCAkb3V0cHV0LCAkdGhpcy0+c2hvcnRjb2RlICk7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRhdHRzDQoJCSAqIEBwYXJhbSAkY29udGVudA0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGNvbnRlbnRBZG1pbiggJGF0dHMsICRjb250ZW50ICkgew0KCQkJJGVsZW1lbnQgPSAkdGhpcy0+c2hvcnRjb2RlOw0KCQkJJG91dHB1dCA9ICRjdXN0b21fbWFya3VwID0gJHdpZHRoID0gJGVsX3Bvc2l0aW9uID0gJyc7DQoNCgkJCWlmICggJGNvbnRlbnQgIT0gbnVsbCApIHsNCgkJCQkkY29udGVudCA9IHdwYXV0b3AoIHN0cmlwc2xhc2hlcyggJGNvbnRlbnQgKSApOw0KCQkJfQ0KCQkJJHNob3J0Y29kZV9hdHRyaWJ1dGVzID0gYXJyYXkoICd3aWR0aCcgPT4gJzEvMScgKTsNCgkJCWZvcmVhY2ggKCAkdGhpcy0+c2V0dGluZ3NbJ3BhcmFtcyddIGFzICRwYXJhbSApIHsNCgkJCQlpZiAoICRwYXJhbVsncGFyYW1fbmFtZSddICE9ICdjb250ZW50JyApIHsNCgkJCQkJaWYgKCBpc3NldCggJHBhcmFtWyd2YWx1ZSddICkgKSB7DQoJCQkJCQkkc2hvcnRjb2RlX2F0dHJpYnV0ZXNbICRwYXJhbVsncGFyYW1fbmFtZSddIF0gPSBpc19zdHJpbmcoICRwYXJhbVsndmFsdWUnXSApID8gX18oICRwYXJhbVsndmFsdWUnXSwgImpzX2NvbXBvc2VyIiApIDogJHBhcmFtWyd2YWx1ZSddOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJJHNob3J0Y29kZV9hdHRyaWJ1dGVzWyAkcGFyYW1bJ3BhcmFtX25hbWUnXSBdID0gJyc7DQoJCQkJCX0NCgkJCQl9IGVsc2UgaWYgKCAkcGFyYW1bJ3BhcmFtX25hbWUnXSA9PSAnY29udGVudCcgJiYgJGNvbnRlbnQgPT0gbnVsbCApIHsNCgkJCQkJJGNvbnRlbnQgPSBpc3NldCggJHBhcmFtWyd2YWx1ZSddICkgPyBfXyggJHBhcmFtWyd2YWx1ZSddLCAianNfY29tcG9zZXIiICkgOiAnJzsNCgkJCQl9DQoJCQl9DQoJCQkkYXR0cyA9IHNob3J0Y29kZV9hdHRzKA0KCQkJCSRzaG9ydGNvZGVfYXR0cmlidXRlcw0KCQkJCSwgJGF0dHMgKTsNCgkJCWV4dHJhY3QoICRhdHRzICk7DQoJCQkkdGhpcy0+YXR0cyA9ICRhdHRzOw0KCQkJJGVsZW0gPSAkdGhpcy0+Z2V0RWxlbWVudEhvbGRlciggJHdpZHRoICk7DQoJCQlpZiAoIGlzc2V0KCAkdGhpcy0+c2V0dGluZ3NbImN1c3RvbV9tYXJrdXAiXSApICYmICR0aGlzLT5zZXR0aW5nc1siY3VzdG9tX21hcmt1cCJdICE9ICcnICkgew0KCQkJCSRtYXJrdXAgPSAkdGhpcy0+c2V0dGluZ3NbJ2N1c3RvbV9tYXJrdXAnXTsNCgkJCQkkZWxlbSA9IHN0cl9pcmVwbGFjZSggJyV3cGJfZWxlbWVudF9jb250ZW50JScsICR0aGlzLT5jdXN0b21NYXJrdXAoICRtYXJrdXAsICRjb250ZW50ICksICRlbGVtICk7DQoJCQkJJG91dHB1dCAuPSAkZWxlbTsNCgkJCX0gZWxzZSB7DQoJCQkJJGluZXIgPSAkdGhpcy0+b3V0cHV0VGl0bGUoICR0aGlzLT5zZXR0aW5nc1snbmFtZSddICk7DQoJCQkJJGluZXIgLj0gJHRoaXMtPnBhcmFtc0h0bWxIb2xkZXJzKCAkYXR0cyApOw0KCQkJCSRlbGVtID0gc3RyX2lyZXBsYWNlKCAnJXdwYl9lbGVtZW50X2NvbnRlbnQlJywgJGluZXIsICRlbGVtICk7DQoJCQkJJG91dHB1dCAuPSAkZWxlbTsNCgkJCX0NCg0KCQkJcmV0dXJuICRvdXRwdXQ7DQoJCX0NCg0KCQkvKioNCgkJICogQHJldHVybiBib29sDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gaXNBZG1pbigpIHsNCgkJCXJldHVybiBhcHBseV9maWx0ZXJzKCAndmNfc2hvcnRjb2Rlc19pc19hZG1pbicsIGlzX2FkbWluKCkgKTsgLy8gICYmICEgZW1wdHkoICRfUE9TVFsnYWN0aW9uJ10gKSAmJiBwcmVnX21hdGNoKCAnL153cGJcXy8nLCAkX1BPU1RbJ2FjdGlvbiddICk7DQoJCX0NCg0KCQkvKioNCgkJICogQHJldHVybiBib29sDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gaXNJbmxpbmUoKSB7DQoJCQlyZXR1cm4gdmNfaXNfaW5saW5lKCk7DQoJCX0NCg0KCQkvKioNCgkJICogQHJldHVybiBib29sDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gaXNFZGl0b3IoKSB7DQoJCQlyZXR1cm4gdmNfaXNfZWRpdG9yKCk7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRhdHRzDQoJCSAqIEBwYXJhbSBudWxsICRjb250ZW50DQoJCSAqIEBwYXJhbSBzdHJpbmcgJGJhc2UNCgkJICoNCgkJICogdmNfZmlsdGVyOiB2Y19zaG9ydGNvZGVfb3V0cHV0IC0gaG9vayB0byBvdmVycmlkZSBvdXRwdXQgb2Ygc2hvcnRjb2RlDQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gb3V0cHV0KCAkYXR0cywgJGNvbnRlbnQgPSBudWxsLCAkYmFzZSA9ICcnICkgew0KCQkJJHRoaXMtPmF0dHMgPSAkdGhpcy0+cHJlcGFyZUF0dHMoICRhdHRzICk7DQoJCQkkdGhpcy0+c2hvcnRjb2RlX2NvbnRlbnQgPSAkY29udGVudDsNCgkJCSRvdXRwdXQgPSAnJzsNCgkJCSRjb250ZW50ID0gZW1wdHkoICRjb250ZW50ICkgJiYgISBlbXB0eSggJGF0dHNbJ2NvbnRlbnQnXSApID8gJGF0dHNbJ2NvbnRlbnQnXSA6ICRjb250ZW50Ow0KCQkJaWYgKCAoICR0aGlzLT5pc0lubGluZSgpIHx8IHZjX2lzX3BhZ2VfZWRpdGFibGUoKSApICYmIG1ldGhvZF9leGlzdHMoICR0aGlzLCAnY29udGVudElubGluZScgKSApIHsNCgkJCQkkb3V0cHV0IC49ICR0aGlzLT5jb250ZW50SW5saW5lKCAkdGhpcy0+YXR0cywgJGNvbnRlbnQgKTsNCgkJCX0gZWxzZSB7DQoJCQkJJHRoaXMtPmVucXVldWVEZWZhdWx0U2NyaXB0cygpOw0KCQkJCSRjdXN0b21fb3V0cHV0ID0gVkNfU0hPUlRDT0RFX0NVU1RPTUlaRV9QUkVGSVggLiAkdGhpcy0+c2hvcnRjb2RlOw0KCQkJCSRjdXN0b21fb3V0cHV0X2JlZm9yZSA9IFZDX1NIT1JUQ09ERV9CRUZPUkVfQ1VTVE9NSVpFX1BSRUZJWCAuICR0aGlzLT5zaG9ydGNvZGU7IC8vIGJlZm9yZSBzaG9ydGNvZGUgZnVuY3Rpb24gaG9vaw0KCQkJCSRjdXN0b21fb3V0cHV0X2FmdGVyID0gVkNfU0hPUlRDT0RFX0FGVEVSX0NVU1RPTUlaRV9QUkVGSVggLiAkdGhpcy0+c2hvcnRjb2RlOyAvLyBhZnRlciBzaG9ydGNvZGUgZnVuY3Rpb24gaG9vaw0KDQoJCQkJLy8gQmVmb3JlIHNob3J0Y29kZQ0KCQkJCWlmICggZnVuY3Rpb25fZXhpc3RzKCAkY3VzdG9tX291dHB1dF9iZWZvcmUgKSApIHsNCgkJCQkJJG91dHB1dCAuPSAkY3VzdG9tX291dHB1dF9iZWZvcmUoICR0aGlzLT5hdHRzLCAkY29udGVudCApOw0KCQkJCX0gZWxzZSB7DQoJCQkJCSRvdXRwdXQgLj0gJHRoaXMtPmJlZm9yZVNob3J0Y29kZSggJHRoaXMtPmF0dHMsICRjb250ZW50ICk7DQoJCQkJfQ0KCQkJCS8vIFNob3J0Y29kZSBjb250ZW50DQoJCQkJaWYgKCBmdW5jdGlvbl9leGlzdHMoICRjdXN0b21fb3V0cHV0ICkgKSB7DQoJCQkJCSRvdXRwdXQgLj0gJGN1c3RvbV9vdXRwdXQoICR0aGlzLT5hdHRzLCAkY29udGVudCApOw0KCQkJCX0gZWxzZSB7DQoJCQkJCSRvdXRwdXQgLj0gJHRoaXMtPmNvbnRlbnQoICR0aGlzLT5hdHRzLCAkY29udGVudCApOw0KCQkJCX0NCgkJCQkvLyBBZnRlciBzaG9ydGNvZGUNCgkJCQlpZiAoIGZ1bmN0aW9uX2V4aXN0cyggJGN1c3RvbV9vdXRwdXRfYWZ0ZXIgKSApIHsNCgkJCQkJJG91dHB1dCAuPSAkY3VzdG9tX291dHB1dF9hZnRlciggJHRoaXMtPmF0dHMsICRjb250ZW50ICk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJJG91dHB1dCAuPSAkdGhpcy0+YWZ0ZXJTaG9ydGNvZGUoICR0aGlzLT5hdHRzLCAkY29udGVudCApOw0KCQkJCX0NCgkJCX0NCgkJCS8vIEZpbHRlciBmb3Igb3ZlcnJpZGluZyBvdXRwdXRzDQoJCQkkb3V0cHV0ID0gYXBwbHlfZmlsdGVycyggJ3ZjX3Nob3J0Y29kZV9vdXRwdXQnLCAkb3V0cHV0LCAkdGhpcywgJHRoaXMtPmF0dHMgKTsNCg0KCQkJcmV0dXJuICRvdXRwdXQ7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gZW5xdWV1ZURlZmF1bHRTY3JpcHRzKCkgew0KCQkJaWYgKCBmYWxzZSA9PT0gc2VsZjo6JGRlZmF1bHRfc2NyaXB0c19lbnF1ZXVlZCApIHsNCgkJCQl3cF9lbnF1ZXVlX3NjcmlwdCggJ3dwYl9jb21wb3Nlcl9mcm9udF9qcycgKTsNCgkJCQl3cF9lbnF1ZXVlX3N0eWxlKCAnanNfY29tcG9zZXJfZnJvbnQnICk7DQoJCQkJc2VsZjo6JGRlZmF1bHRfc2NyaXB0c19lbnF1ZXVlZCA9IHRydWU7DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJICogUmV0dXJuIHNob3J0Y29kZSBhdHRyaWJ1dGVzLCBzZWUgXFdQQmFrZXJ5U2hvcnRDb2RlOjpvdXRwdXQNCgkJICogQHNpbmNlIDQuNA0KCQkgKiBAcmV0dXJuIGFycmF5DQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gZ2V0QXR0cygpIHsNCgkJCXJldHVybiAkdGhpcy0+YXR0czsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBDcmVhdGVzIGh0bWwgYmVmb3JlIHNob3J0Y29kZSBodG1sLg0KCQkgKg0KCQkgKiBAcGFyYW0gJGF0dHMgLSBzaG9ydGNvZGUgYXR0cmlidXRlcyBsaXN0DQoJCSAqIEBwYXJhbSAkY29udGVudCAtIHNob3J0Y29kZSBjb250ZW50DQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nIC0gaHRtbCB3aGljaCB3aWxsIGJlIGRpc3BsYXllZCBiZWZvcmUgc2hvcnRjb2RlIGh0bWwuDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gYmVmb3JlU2hvcnRjb2RlKCAkYXR0cywgJGNvbnRlbnQgKSB7DQoJCQlyZXR1cm4gJyc7DQoJCX0NCg0KCQkvKioNCgkJICogQ3JlYXRlcyBodG1sIGJlZm9yZSBzaG9ydGNvZGUgaHRtbC4NCgkJICoNCgkJICogQHBhcmFtICRhdHRzIC0gc2hvcnRjb2RlIGF0dHJpYnV0ZXMgbGlzdA0KCQkgKiBAcGFyYW0gJGNvbnRlbnQgLSBzaG9ydGNvZGUgY29udGVudA0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZyAtIGh0bWwgd2hpY2ggd2lsbCBiZSBkaXNwbGF5ZWQgYWZ0ZXIgc2hvcnRjb2RlIGh0bWwuDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gYWZ0ZXJTaG9ydGNvZGUoICRhdHRzLCAkY29udGVudCApIHsNCgkJCXJldHVybiAnJzsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJGVsX2NsYXNzDQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gZ2V0RXh0cmFDbGFzcyggJGVsX2NsYXNzICkgew0KCQkJJG91dHB1dCA9ICcnOw0KCQkJaWYgKCAkZWxfY2xhc3MgIT0gJycgKSB7DQoJCQkJJG91dHB1dCA9ICIgIiAuIHN0cl9yZXBsYWNlKCAiLiIsICIiLCAkZWxfY2xhc3MgKTsNCgkJCX0NCg0KCQkJcmV0dXJuICRvdXRwdXQ7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRjc3NfYW5pbWF0aW9uDQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gZ2V0Q1NTQW5pbWF0aW9uKCAkY3NzX2FuaW1hdGlvbiApIHsNCgkJCSRvdXRwdXQgPSAnJzsNCgkJCWlmICggJGNzc19hbmltYXRpb24gIT0gJycgKSB7DQoJCQkJd3BfZW5xdWV1ZV9zY3JpcHQoICd3YXlwb2ludHMnICk7DQoJCQkJJG91dHB1dCA9ICcgd3BiX2FuaW1hdGVfd2hlbl9hbG1vc3RfdmlzaWJsZSB3cGJfJyAuICRjc3NfYW5pbWF0aW9uOw0KCQkJfQ0KDQoJCQlyZXR1cm4gJG91dHB1dDsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBDcmVhdGUgSFRNTCBjb21tZW50IGZvciBibG9ja3Mgb25seSBpZiB3cGJfZGVidWc9dHJ1ZQ0KCQkgKg0KCQkgKiBAcGFyYW0gJHN0cmluZw0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGVuZEJsb2NrQ29tbWVudCggJHN0cmluZyApIHsNCgkJCS8vcmV0dXJuICcnOw0KCQkJcmV0dXJuIHdwYl9kZWJ1ZygpID8gJzwhLS0gRU5EICcgLiAkc3RyaW5nIC4gJyAtLT4nIDogJyc7DQoJCX0NCg0KCQkvKioNCgkJICogU3RhcnQgcm93IGNvbW1lbnQgZm9yIGh0bWwgc2hvcnRjb2RlIGJsb2NrDQoJCSAqDQoJCSAqIEBwYXJhbSAkcG9zaXRpb24gLSBibG9jayBwb3NpdGlvbg0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIHN0YXJ0Um93KCAkcG9zaXRpb24gKSB7DQoJCQkkb3V0cHV0ID0gJyc7DQoNCgkJCXJldHVybiAnJzsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBFbmQgcm93IGNvbW1lbnQgZm9yIGh0bWwgc2hvcnRjb2RlIGJsb2NrDQoJCSAqDQoJCSAqIEBwYXJhbSAkcG9zaXRpb24gLWJsb2NrIHBvc2l0aW9uDQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KDQoJCXB1YmxpYyBmdW5jdGlvbiBlbmRSb3coICRwb3NpdGlvbiApIHsNCgkJCSRvdXRwdXQgPSAnJzsNCg0KCQkJcmV0dXJuICcnOw0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkbmFtZQ0KCQkgKg0KCQkgKiBAcmV0dXJuIG51bGwNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBzZXR0aW5ncyggJG5hbWUgKSB7DQoJCQlyZXR1cm4gaXNzZXQoICR0aGlzLT5zZXR0aW5nc1sgJG5hbWUgXSApID8gJHRoaXMtPnNldHRpbmdzWyAkbmFtZSBdIDogbnVsbDsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJG5hbWUNCgkJICogQHBhcmFtICR2YWx1ZQ0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIHNldFNldHRpbmdzKCAkbmFtZSwgJHZhbHVlICkgew0KCQkJJHRoaXMtPnNldHRpbmdzWyAkbmFtZSBdID0gJHZhbHVlOw0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkd2lkdGgNCgkJICoNCgkJICogQHJldHVybiBzdHJpbmcNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBnZXRFbGVtZW50SG9sZGVyKCAkd2lkdGggKSB7DQoJCQkkb3V0cHV0ID0gJyc7DQoJCQkkY29sdW1uX2NvbnRyb2xzID0gJHRoaXMtPmdldENvbHVtbkNvbnRyb2xzTW9kdWxhcigpOw0KCQkJJGNzc19jbGFzcyA9ICd3cGJfJyAuICR0aGlzLT5zZXR0aW5nc1siYmFzZSJdIC4gJyB3cGJfY29udGVudF9lbGVtZW50IHdwYl9zb3J0YWJsZScgLiAoICEgZW1wdHkoICR0aGlzLT5zZXR0aW5nc1siY2xhc3MiXSApID8gJyAnIC4gJHRoaXMtPnNldHRpbmdzWyJjbGFzcyJdIDogJycgKTsNCgkJCSRvdXRwdXQgLj0gJzxkaXYgZGF0YS1lbGVtZW50X3R5cGU9IicgLiAkdGhpcy0+c2V0dGluZ3NbImJhc2UiXSAuICciIGNsYXNzPSInIC4gJGNzc19jbGFzcyAuICciPic7DQoJCQkkb3V0cHV0IC49IHN0cl9yZXBsYWNlKCAiJWNvbHVtbl9zaXplJSIsIHdwYl90cmFuc2xhdGVDb2x1bW5XaWR0aFRvRnJhY3Rpb25hbCggJHdpZHRoICksICRjb2x1bW5fY29udHJvbHMgKTsNCgkJCSRvdXRwdXQgLj0gJHRoaXMtPmdldENhbGxiYWNrcyggJHRoaXMtPnNob3J0Y29kZSApOw0KCQkJJG91dHB1dCAuPSAnPGRpdiBjbGFzcz0id3BiX2VsZW1lbnRfd3JhcHBlciAnIC4gJHRoaXMtPnNldHRpbmdzKCAid3JhcHBlcl9jbGFzcyIgKSAuICciPic7DQoJCQkkb3V0cHV0IC49ICcld3BiX2VsZW1lbnRfY29udGVudCUnOw0KCQkJJG91dHB1dCAuPSAnPC9kaXY+JzsgLy8gPCEtLSBlbmQgLndwYl9lbGVtZW50X3dyYXBwZXIgLS0+JzsNCgkJCSRvdXRwdXQgLj0gJzwvZGl2Pic7IC8vIDwhLS0gZW5kICNlbGVtZW50LScuJHRoaXMtPnNob3J0Y29kZS4nIC0tPic7DQoJCQlyZXR1cm4gJG91dHB1dDsNCgkJfQ0KDQoJCS8qIFRoaXMgcmV0dXJzIGJsb2NrIGNvbnRyb2xzDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQoJCS8qKg0KCQkgKiBAcGFyYW0gJGNvbnRyb2xzDQoJCSAqIEBwYXJhbSBzdHJpbmcgJGV4dGVuZGVkX2Nzcw0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGdldENvbHVtbkNvbnRyb2xzKCAkY29udHJvbHMsICRleHRlbmRlZF9jc3MgPSAnJyApIHsNCgkJCSRjb250cm9sc19zdGFydCA9ICc8ZGl2IGNsYXNzPSJ2Y19jb250cm9scyBjb250cm9scyBjb250cm9sc19lbGVtZW50JyAuICggISBlbXB0eSggJGV4dGVuZGVkX2NzcyApID8gIiB7JGV4dGVuZGVkX2Nzc30iIDogJycgKSAuICciPic7DQoNCgkJCSRjb250cm9sc19lbmQgPSAnPC9kaXY+JzsNCg0KCQkJJGNvbnRyb2xzX2FkZCA9ICcnOyAvLycgPGEgY2xhc3M9ImNvbHVtbl9hZGQiIGhyZWY9IiMiIHRpdGxlPSInLnNwcmludGYoX18oJ0FkZCB0byAlcycsICdqc19jb21wb3NlcicpLCBzdHJ0b2xvd2VyKCR0aGlzLT5zZXR0aW5ncygnbmFtZScpKSkuJyI+PC9hPic7DQoJCQkkY29udHJvbHNfZWRpdCA9ICcgPGEgY2xhc3M9InZjX2NvbnRyb2wgY29sdW1uX2VkaXQiIGhyZWY9IiMiIHRpdGxlPSInIC4gc3ByaW50ZiggX18oICdFZGl0ICVzJywgJ2pzX2NvbXBvc2VyJyApLCBzdHJ0b2xvd2VyKCAkdGhpcy0+c2V0dGluZ3MoICduYW1lJyApICkgKSAuICciPjxzcGFuIGNsYXNzPSJ2Y19pY29uIj48L3NwYW4+PC9hPic7DQoJCQkkY29udHJvbHNfZGVsZXRlID0gJyA8YSBjbGFzcz0idmNfY29udHJvbCBjb2x1bW5fY2xvbmUiIGhyZWY9IiMiIHRpdGxlPSInIC4gc3ByaW50ZiggX18oICdDbG9uZSAlcycsICdqc19jb21wb3NlcicgKSwgc3RydG9sb3dlciggJHRoaXMtPnNldHRpbmdzKCAnbmFtZScgKSApICkgLiAnIj48c3BhbiBjbGFzcz0idmNfaWNvbiI+PC9zcGFuPjwvYT4gPGEgY2xhc3M9ImNvbHVtbl9kZWxldGUiIGhyZWY9IiMiIHRpdGxlPSInIC4gc3ByaW50ZiggX18oICdEZWxldGUgJXMnLCAnanNfY29tcG9zZXInICksIHN0cnRvbG93ZXIoICR0aGlzLT5zZXR0aW5ncyggJ25hbWUnICkgKSApIC4gJyI+PHNwYW4gY2xhc3M9InZjX2ljb24iPjwvc3Bhbj48L2E+JzsNCg0KCQkJJGNvbHVtbl9jb250cm9sc19mdWxsID0gJGNvbnRyb2xzX3N0YXJ0IC4gJGNvbnRyb2xzX2FkZCAuICRjb250cm9sc19lZGl0IC4gJGNvbnRyb2xzX2RlbGV0ZSAuICRjb250cm9sc19lbmQ7DQoJCQkkY29sdW1uX2NvbnRyb2xzX3NpemVfZGVsZXRlID0gJGNvbnRyb2xzX3N0YXJ0IC4gJGNvbnRyb2xzX2RlbGV0ZSAuICRjb250cm9sc19lbmQ7DQoJCQkkY29sdW1uX2NvbnRyb2xzX3BvcHVwX2RlbGV0ZSA9ICRjb250cm9sc19zdGFydCAuICRjb250cm9sc19kZWxldGUgLiAkY29udHJvbHNfZW5kOw0KCQkJJGNvbHVtbl9jb250cm9sc19lZGl0X3BvcHVwX2RlbGV0ZSA9ICRjb250cm9sc19zdGFydCAuICRjb250cm9sc19lZGl0IC4gJGNvbnRyb2xzX2RlbGV0ZSAuICRjb250cm9sc19lbmQ7DQoNCgkJCWlmICggJGNvbnRyb2xzID09ICdwb3B1cF9kZWxldGUnICkgew0KCQkJCXJldHVybiAkY29sdW1uX2NvbnRyb2xzX3BvcHVwX2RlbGV0ZTsNCgkJCX0gZWxzZSBpZiAoICRjb250cm9scyA9PSAnZWRpdF9wb3B1cF9kZWxldGUnICkgew0KCQkJCXJldHVybiAkY29sdW1uX2NvbnRyb2xzX2VkaXRfcG9wdXBfZGVsZXRlOw0KCQkJfSBlbHNlIGlmICggJGNvbnRyb2xzID09ICdzaXplX2RlbGV0ZScgKSB7DQoJCQkJcmV0dXJuICRjb2x1bW5fY29udHJvbHNfc2l6ZV9kZWxldGU7DQoJCQl9IGVsc2UgaWYgKCAkY29udHJvbHMgPT0gJ2FkZCcgKSB7DQoJCQkJcmV0dXJuICRjb250cm9sc19zdGFydCAuICRjb250cm9sc19hZGQgLiAkY29udHJvbHNfZW5kOw0KCQkJfSBlbHNlIHsNCgkJCQlyZXR1cm4gJGNvbHVtbl9jb250cm9sc19mdWxsOw0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSAqIFJldHVybiBsaXN0IG9mIGNvbnRyb2xzDQoJCSAqIEByZXR1cm4gYXJyYXkNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBnZXRDb250cm9sc0xpc3QoKSB7DQoJCQlyZXR1cm4gYXBwbHlfZmlsdGVycyggJ3ZjX3dwYmFrZXJ5X3Nob3J0Y29kZV9nZXRfY29udHJvbHNfbGlzdCcsICR0aGlzLT5jb250cm9sc19saXN0LCAkdGhpcy0+c2hvcnRjb2RlICk7DQoJCX0NCg0KCQkvKioNCgkJICogQnVpbGQgbmV3IG1vZGVybiBjb250cm9scyBmb3Igc2hvcnRjb2RlLg0KCQkgKg0KCQkgKiBAcGFyYW0gc3RyaW5nICRleHRlbmRlZF9jc3MNCgkJICoNCgkJICogQHJldHVybiBzdHJpbmcNCgkJICoNCgkJICogQHBhcmFtIHN0cmluZyAkcG9zaXRpb24gLSB5LHggcG9zaXRpb24gd2hlcmUgdG8gcHV0IGNvbnRyb2xzIGluc2lkZSBibG9jaw0KCQkgKiAgICBQb3NzaWJsZSAkcG9zaXRpb24gdmFsdWVzDQoJCSAqICAgIGNjIC0gY2VudGVyIGNlbnRlciBwb3NpdGlvbiBvZiB0aGUgYmxvY2sNCgkJICogICAgdGwgLSB0b3AgbGVmdA0KCQkgKiAgICB0ciAtIHRvcCByaWdodA0KCQkgKiAgICBiciAtIGJvdHRvbSByaWdodA0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGdldENvbHVtbkNvbnRyb2xzTW9kdWxhciggJGV4dGVuZGVkX2NzcyA9ICcnICkgew0KCQkJb2Jfc3RhcnQoKTsNCgkJCXZjX2luY2x1ZGVfdGVtcGxhdGUoIGFwcGx5X2ZpbHRlcnMoICd2Y193cGJha2VyeV9zaG9ydGNvZGVfZ2V0X2NvbHVtbl9jb250cm9sc19tb2R1bGFyX3RlbXBsYXRlJywNCgkJCQkkdGhpcy0+Y29udHJvbHNfdGVtcGxhdGVfZmlsZSApLCBhcnJheSgNCgkJCQknc2hvcnRjb2RlJyA9PiAkdGhpcy0+c2hvcnRjb2RlLA0KCQkJCSdwb3NpdGlvbicgPT4gJHRoaXMtPmNvbnRyb2xzX2Nzc19zZXR0aW5ncywNCgkJCQknZXh0ZW5kZWRfY3NzJyA9PiAkZXh0ZW5kZWRfY3NzLA0KCQkJCSduYW1lJyA9PiAkdGhpcy0+c2V0dGluZ3MoICduYW1lJyApLA0KCQkJCSdjb250cm9scycgPT4gJHRoaXMtPmdldENvbnRyb2xzTGlzdCgpDQoJCQkpICk7DQoNCgkJCXJldHVybiBvYl9nZXRfY2xlYW4oKTsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBUaGlzIHdpbGwgZmlyZSBjYWxsYmFja3MgaWYgdGhleSBhcmUgZGVmaW5lZCBpbiBtYXAucGhwDQoJCSAqDQoJCSAqIEBwYXJhbSAkaWQNCgkJICoNCgkJICogQHJldHVybiBzdHJpbmcNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBnZXRDYWxsYmFja3MoICRpZCApIHsNCgkJCSRvdXRwdXQgPSAnJzsNCg0KCQkJaWYgKCBpc3NldCggJHRoaXMtPnNldHRpbmdzWydqc19jYWxsYmFjayddICkgKSB7DQoJCQkJZm9yZWFjaCAoICR0aGlzLT5zZXR0aW5nc1snanNfY2FsbGJhY2snXSBhcyAkdGV4dF92YWwgPT4gJHZhbCApIHsNCgkJCQkJLyogVE9ETzogbmFtZSBleHBsYWluICovDQoJCQkJCSRvdXRwdXQgLj0gJzxpbnB1dCB0eXBlPSJoaWRkZW4iIGNsYXNzPSJ3cGJfdmNfY2FsbGJhY2sgd3BiX3ZjXycgLiAkdGV4dF92YWwgLiAnX2NhbGxiYWNrICIgbmFtZT0iJyAuICR0ZXh0X3ZhbCAuICciIHZhbHVlPSInIC4gJHZhbCAuICciIC8+JzsNCgkJCQl9DQoJCQl9DQoNCgkJCXJldHVybiAkb3V0cHV0Ow0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkcGFyYW0NCgkJICogQHBhcmFtICR2YWx1ZQ0KCQkgKg0KCQkgKiB2Y19maWx0ZXI6IHZjX3dwYmFrZXJ5c2hvcnRjb2RlX3NpbmdsZV9wYXJhbV9odG1sX2hvbGRlcl92YWx1ZSAtIGhvb2sgdG8gb3ZlcnJpZGUgcGFyYW0gdmFsdWUgKHBhcmFtIHR5cGUgYW5kIGV0YyBpcyBhdmFpbGFibGUgaW4gYXJncykNCgkJICoNCgkJICogQHJldHVybiBzdHJpbmcNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBzaW5nbGVQYXJhbUh0bWxIb2xkZXIoICRwYXJhbSwgJHZhbHVlICkgew0KCQkJJHZhbHVlID0gYXBwbHlfZmlsdGVycyggJ3ZjX3dwYmFrZXJ5c2hvcnRjb2RlX3NpbmdsZV9wYXJhbV9odG1sX2hvbGRlcl92YWx1ZScsICR2YWx1ZSwgJHBhcmFtLCAkdGhpcy0+c2V0dGluZ3MsICR0aGlzLT5hdHRzICk7DQoJCQkkb3V0cHV0ID0gJyc7DQoJCQkvLyBDb21wYXRpYmlsaXR5IGZpeGVzDQoJCQkkb2xkX25hbWVzID0gYXJyYXkoDQoJCQkJJ3llbGxvd19tZXNzYWdlJywNCgkJCQknYmx1ZV9tZXNzYWdlJywNCgkJCQknZ3JlZW5fbWVzc2FnZScsDQoJCQkJJ2J1dHRvbl9ncmVlbicsDQoJCQkJJ2J1dHRvbl9ncmV5JywNCgkJCQknYnV0dG9uX3llbGxvdycsDQoJCQkJJ2J1dHRvbl9ibHVlJywNCgkJCQknYnV0dG9uX3JlZCcsDQoJCQkJJ2J1dHRvbl9vcmFuZ2UnDQoJCQkpOw0KCQkJJG5ld19uYW1lcyA9IGFycmF5KA0KCQkJCSdhbGVydC1ibG9jaycsDQoJCQkJJ2FsZXJ0LWluZm8nLA0KCQkJCSdhbGVydC1zdWNjZXNzJywNCgkJCQknYnRuLXN1Y2Nlc3MnLA0KCQkJCSdidG4nLA0KCQkJCSdidG4taW5mbycsDQoJCQkJJ2J0bi1wcmltYXJ5JywNCgkJCQknYnRuLWRhbmdlcicsDQoJCQkJJ2J0bi13YXJuaW5nJw0KCQkJKTsNCgkJCSR2YWx1ZSA9IHN0cl9pcmVwbGFjZSggJG9sZF9uYW1lcywgJG5ld19uYW1lcywgJHZhbHVlICk7DQoJCQkvLyR2YWx1ZSA9IF9fKCR2YWx1ZSwgImpzX2NvbXBvc2VyIik7DQoJCQkvLw0KCQkJJHBhcmFtX25hbWUgPSBpc3NldCggJHBhcmFtWydwYXJhbV9uYW1lJ10gKSA/ICRwYXJhbVsncGFyYW1fbmFtZSddIDogJyc7DQoJCQkkdHlwZSA9IGlzc2V0KCAkcGFyYW1bJ3R5cGUnXSApID8gJHBhcmFtWyd0eXBlJ10gOiAnJzsNCgkJCSRjbGFzcyA9IGlzc2V0KCAkcGFyYW1bJ2NsYXNzJ10gKSA/ICRwYXJhbVsnY2xhc3MnXSA6ICcnOw0KCQkJaWYgKCAhIGVtcHR5KCAkcGFyYW1bJ2hvbGRlciddICkgKSB7DQoJCQkJaWYgKCAkcGFyYW1bJ2hvbGRlciddID09ICdpbnB1dCcgKSB7DQoJCQkJCSRvdXRwdXQgLj0gJzwnIC4gJHBhcmFtWydob2xkZXInXSAuICcgcmVhZG9ubHk9InRydWUiIGNsYXNzPSJ3cGJfdmNfcGFyYW1fdmFsdWUgJyAuICRwYXJhbV9uYW1lIC4gJyAnIC4gJHR5cGUgLiAnICcgLiAkY2xhc3MgLiAnIiBuYW1lPSInIC4gJHBhcmFtX25hbWUgLiAnIiB2YWx1ZT0iJyAuICR2YWx1ZSAuICciPic7DQoJCQkJfSBlbHNlaWYgKCBpbl9hcnJheSggJHBhcmFtWydob2xkZXInXSwgYXJyYXkoICdpbWcnLCAnaWZyYW1lJyApICkgKSB7DQoJCQkJCSRvdXRwdXQgLj0gJzwnIC4gJHBhcmFtWydob2xkZXInXSAuICcgY2xhc3M9IndwYl92Y19wYXJhbV92YWx1ZSAnIC4gJHBhcmFtX25hbWUgLiAnICcgLiAkdHlwZSAuICcgJyAuICRjbGFzcyAuICciIG5hbWU9IicgLiAkcGFyYW1fbmFtZSAuICciIHNyYz0iJyAuICR2YWx1ZSAuICciPic7DQoJCQkJfSBlbHNlaWYgKCAkcGFyYW1bJ2hvbGRlciddICE9PSAnaGlkZGVuJyApIHsNCgkJCQkJJG91dHB1dCAuPSAnPCcgLiAkcGFyYW1bJ2hvbGRlciddIC4gJyBjbGFzcz0id3BiX3ZjX3BhcmFtX3ZhbHVlICcgLiAkcGFyYW1fbmFtZSAuICcgJyAuICR0eXBlIC4gJyAnIC4gJGNsYXNzIC4gJyIgbmFtZT0iJyAuICRwYXJhbV9uYW1lIC4gJyI+JyAuICR2YWx1ZSAuICc8LycgLiAkcGFyYW1bJ2hvbGRlciddIC4gJz4nOw0KCQkJCX0NCgkJCX0NCgkJCWlmICggISBlbXB0eSggJHBhcmFtWydhZG1pbl9sYWJlbCddICkgJiYgJHBhcmFtWydhZG1pbl9sYWJlbCddID09PSB0cnVlICkgew0KCQkJCSRvdXRwdXQgLj0gJzxzcGFuIGNsYXNzPSJ2Y19hZG1pbl9sYWJlbCBhZG1pbl9sYWJlbF8nIC4gJHBhcmFtWydwYXJhbV9uYW1lJ10gLiAoIGVtcHR5KCAkdmFsdWUgKSA/ICcgaGlkZGVuLWxhYmVsJyA6ICcnICkgLiAnIj48bGFiZWw+JyAuIF9fKCAkcGFyYW1bJ2hlYWRpbmcnXSwgJ2pzX2NvbXBvc2VyJyApIC4gJzwvbGFiZWw+OiAnIC4gJHZhbHVlIC4gJzwvc3Bhbj4nOw0KCQkJfQ0KDQoJCQlyZXR1cm4gJG91dHB1dDsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJHBhcmFtcw0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEljb24oICRwYXJhbXMgKSB7DQoJCQkkZGF0YSA9ICcnOw0KCQkJaWYgKCBpc3NldCggJHBhcmFtc1snaXNfY29udGFpbmVyJ10gKSAmJiAkcGFyYW1zWydpc19jb250YWluZXInXSA9PT0gdHJ1ZSApIHsNCgkJCQkkZGF0YSA9ICcgZGF0YS1pcy1jb250YWluZXI9InRydWUiJzsNCgkJCX0NCgkJCSR0aXRsZSA9ICcnOw0KCQkJaWYgKCBpc3NldCggJHBhcmFtc1sndGl0bGUnXSApICkgew0KCQkJCSR0aXRsZSA9ICd0aXRsZT0iJyAuICRwYXJhbXNbJ3RpdGxlJ10gLiAnIiAnOw0KCQkJfQ0KDQoJCQlyZXR1cm4gJzxpICcgLiAkdGl0bGUgLiAnY2xhc3M9InZjX2VsZW1lbnQtaWNvbicgLiAoICEgZW1wdHkoICRwYXJhbXNbJ2ljb24nXSApID8gJyAnIC4gc2FuaXRpemVfdGV4dF9maWVsZCggJHBhcmFtc1snaWNvbiddICkgOiAnJyApIC4gJyInIC4gJGRhdGEgLiAnPjwvaT4gJzsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJHRpdGxlDQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gb3V0cHV0VGl0bGUoICR0aXRsZSApIHsNCgkJCSRpY29uID0gJHRoaXMtPnNldHRpbmdzKCAnaWNvbicgKTsNCgkJCWlmICggZmlsdGVyX3ZhciggJGljb24sIEZJTFRFUl9WQUxJREFURV9VUkwgKSApIHsNCgkJCQkkaWNvbiA9ICcnOw0KCQkJfQ0KCQkJJHBhcmFtcyA9IGFycmF5KA0KCQkJCSdpY29uJyA9PiAkaWNvbiwNCgkJCQknaXNfY29udGFpbmVyJyA9PiAkdGhpcy0+c2V0dGluZ3MoICdpc19jb250YWluZXInICksDQoJCQkpOw0KDQoJCQlyZXR1cm4gJzxoNCBjbGFzcz0id3BiX2VsZW1lbnRfdGl0bGUiPiAnIC4gJHRoaXMtPmdldEljb24oICRwYXJhbXMgKSAuIGVzY19hdHRyKCAkdGl0bGUgKSAuICc8L2g0Pic7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtIHN0cmluZyAkY29udGVudA0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIHRlbXBsYXRlKCAkY29udGVudCA9ICcnICkgew0KCQkJcmV0dXJuICR0aGlzLT5jb250ZW50QWRtaW4oICR0aGlzLT5hdHRzLCAkY29udGVudCApOw0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkYXR0cw0KCQkgKg0KCQkgKiBAcmV0dXJuIGFycmF5DQoJCSAqLw0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gcHJlcGFyZUF0dHMoICRhdHRzICkgew0KCQkJJHJldHVybiA9IGFycmF5KCk7DQoJCQlpZiAoIGlzX2FycmF5KCAkYXR0cyApICkgew0KCQkJCWZvcmVhY2ggKCAkYXR0cyBhcyAka2V5ID0+ICR2YWwgKSB7DQoJCQkJCSRyZXR1cm5bICRrZXkgXSA9IHByZWdfcmVwbGFjZSggJy9cYFxgLycsICciJywgJHZhbCApOw0KCQkJCX0NCgkJCX0NCg0KCQkJcmV0dXJuICRyZXR1cm47DQoJCX0NCg0KCQkvKioNCgkJICogQHJldHVybiBtaXhlZA0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGdldFNob3J0Y29kZSgpIHsNCgkJCXJldHVybiAkdGhpcy0+c2hvcnRjb2RlOw0KCQl9DQoNCgkJLyoqDQoJCSAqIFNpbmNlIDQuNQ0KCQkgKiBQb3NzaWJsZSBwbGFjZWhvbGRlcnM6DQoJCSAqICAgICAge3sgY29udGVudCB9fQ0KCQkgKiAgICAgIHt7IHRpdGxlIH19DQoJCSAqICAgICAge3sgY29udGFpbmVyLWNsYXNzIH19DQoJCSAqICAgICAge3sgcGFyYW1zIH19DQoJCSAqDQoJCSAqIFBvc3NpYmxlIGtleXM6DQoJCSAqICB7ew0KCQkgKiAgPCUNCgkJICogICUNCgkJICogQHNpbmNlIDQuNQ0KCQkgKg0KCQkgKiBAcGFyYW0gJG1hcmt1cA0KCQkgKiBAcGFyYW0gc3RyaW5nICRjb250ZW50DQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gY3VzdG9tTWFya3VwKCAkbWFya3VwLCAkY29udGVudCA9ICcnICkgew0KCQkJJHBhdHRlcm4gPSAnL1x7XHsoW1xzXFNdW15cbl0rPylcfVx9fDwlKFtcc1xTXVteXG5dKz8pJT58JShbXHNcU11bXlxuXSs/KSUvJzsNCgkJCXByZWdfbWF0Y2hfYWxsKCAkcGF0dGVybiwgJG1hcmt1cCwgJG1hdGNoZXMsIFBSRUdfU0VUX09SREVSICk7DQoJCQlpZiAoIGlzX2FycmF5KCAkbWF0Y2hlcyApICYmICEgZW1wdHkoICRtYXRjaGVzICkgKSB7DQoJCQkJZm9yZWFjaCAoICRtYXRjaGVzIGFzICRtYXRjaCApIHsNCgkJCQkJc3dpdGNoICggc3RydG9sb3dlciggdHJpbSggJG1hdGNoWzFdICkgKSApIHsNCgkJCQkJCWNhc2UgJ2NvbnRlbnQnOiB7DQoJCQkJCQkJaWYgKCAkY29udGVudCAhPSAnJyApIHsNCgkJCQkJCQkJJG1hcmt1cCA9IHN0cl9yZXBsYWNlKCAkbWF0Y2hbMF0sICRjb250ZW50LCAkbWFya3VwICk7DQoJCQkJCQkJfSBlbHNlIGlmICggaXNzZXQoICR0aGlzLT5zZXR0aW5nc1siZGVmYXVsdF9jb250ZW50X2luX3RlbXBsYXRlIl0gKSAmJiAkdGhpcy0+c2V0dGluZ3NbImRlZmF1bHRfY29udGVudF9pbl90ZW1wbGF0ZSJdICE9ICcnICkgew0KCQkJCQkJCQkkbWFya3VwID0gc3RyX3JlcGxhY2UoICRtYXRjaFswXSwgJHRoaXMtPnNldHRpbmdzWyJkZWZhdWx0X2NvbnRlbnRfaW5fdGVtcGxhdGUiXSwgJG1hcmt1cCApOw0KCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCSRtYXJrdXAgPSBzdHJfcmVwbGFjZSggJG1hdGNoWzBdLCAnJywgJG1hcmt1cCApOw0KCQkJCQkJCX0NCgkJCQkJCQlicmVhazsNCgkJCQkJCX0NCgkJCQkJCWNhc2UgJ3RpdGxlJzogew0KCQkJCQkJCSRtYXJrdXAgPSBzdHJfcmVwbGFjZSggJG1hdGNoWzBdLCAkdGhpcy0+b3V0cHV0VGl0bGUoICR0aGlzLT5zZXR0aW5nc1snbmFtZSddICksICRtYXJrdXAgKTsNCgkJCQkJCQlicmVhazsNCgkJCQkJCX0NCgkJCQkJCWNhc2UgJ2NvbnRhaW5lci1jbGFzcyc6IHsNCgkJCQkJCQlpZiAoIG1ldGhvZF9leGlzdHMoICR0aGlzLCAnY29udGFpbmVyQ29udGVudENsYXNzJyApICkgew0KCQkJCQkJCQkkbWFya3VwID0gc3RyX3JlcGxhY2UoICRtYXRjaFswXSwgJHRoaXMtPmNvbnRhaW5lckNvbnRlbnRDbGFzcygpLCAkbWFya3VwICk7DQoJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJJG1hcmt1cCA9IHN0cl9yZXBsYWNlKCAkbWF0Y2hbMF0sICcnLCAkbWFya3VwICk7DQoJCQkJCQkJfQ0KCQkJCQkJCWJyZWFrOw0KCQkJCQkJfQ0KCQkJCQkJY2FzZSAncGFyYW1zJzogew0KCQkJCQkJCSRpbmVyID0gJyc7DQoJCQkJCQkJZm9yZWFjaCAoICR0aGlzLT5zZXR0aW5nc1sncGFyYW1zJ10gYXMgJHBhcmFtICkgew0KCQkJCQkJCQkkcGFyYW1fdmFsdWUgPSBpc3NldCggJCRwYXJhbVsncGFyYW1fbmFtZSddICkgPyAkJHBhcmFtWydwYXJhbV9uYW1lJ10gOiAnJzsNCgkJCQkJCQkJaWYgKCBpc19hcnJheSggJHBhcmFtX3ZhbHVlICkgKSB7DQoJCQkJCQkJCQkvLyBHZXQgZmlyc3QgZWxlbWVudCBmcm9tIHRoZSBhcnJheQ0KCQkJCQkJCQkJcmVzZXQoICRwYXJhbV92YWx1ZSApOw0KCQkJCQkJCQkJJGZpcnN0X2tleSA9IGtleSggJHBhcmFtX3ZhbHVlICk7DQoJCQkJCQkJCQkkcGFyYW1fdmFsdWUgPSBpc19udWxsKCAkZmlyc3Rfa2V5ICkgPyAnJyA6ICRwYXJhbV92YWx1ZVsgJGZpcnN0X2tleSBdOw0KCQkJCQkJCQl9DQoJCQkJCQkJCSRpbmVyIC49ICR0aGlzLT5zaW5nbGVQYXJhbUh0bWxIb2xkZXIoICRwYXJhbSwgJHBhcmFtX3ZhbHVlICk7DQoJCQkJCQkJfQ0KCQkJCQkJCSRtYXJrdXAgPSBzdHJfcmVwbGFjZSggJG1hdGNoWzBdLCAkaW5lciwgJG1hcmt1cCApOw0KCQkJCQkJCWJyZWFrOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQlyZXR1cm4gZG9fc2hvcnRjb2RlKCAkbWFya3VwICk7DQoJCX0NCg0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gcGFyYW1zSHRtbEhvbGRlcnMoICRhdHRzICkgew0KCQkJZXh0cmFjdCggJGF0dHMgKTsNCgkJCSRpbmVyID0gJyc7DQoJCQlmb3JlYWNoICggJHRoaXMtPnNldHRpbmdzWydwYXJhbXMnXSBhcyAkcGFyYW0gKSB7DQoJCQkJJHBhcmFtX3ZhbHVlID0gaXNzZXQoICQkcGFyYW1bJ3BhcmFtX25hbWUnXSApID8gJCRwYXJhbVsncGFyYW1fbmFtZSddIDogJyc7DQoJCQkJaWYgKCBpc19hcnJheSggJHBhcmFtX3ZhbHVlICkgKSB7DQoJCQkJCS8vIEdldCBmaXJzdCBlbGVtZW50IGZyb20gdGhlIGFycmF5DQoJCQkJCXJlc2V0KCAkcGFyYW1fdmFsdWUgKTsNCgkJCQkJJGZpcnN0X2tleSA9IGtleSggJHBhcmFtX3ZhbHVlICk7DQoJCQkJCSRwYXJhbV92YWx1ZSA9IGlzX251bGwoICRmaXJzdF9rZXkgKSA/ICcnIDogJHBhcmFtX3ZhbHVlWyAkZmlyc3Rfa2V5IF07DQoJCQkJfQ0KCQkJCSRpbmVyIC49ICR0aGlzLT5zaW5nbGVQYXJhbUh0bWxIb2xkZXIoICRwYXJhbSwgJHBhcmFtX3ZhbHVlICk7DQoJCQl9DQoNCgkJCXJldHVybiAkaW5lcjsNCgkJfQ0KCX0NCn0NCmlmICggISBjbGFzc19leGlzdHMoICdXUEJha2VyeVNob3J0Q29kZXNDb250YWluZXInICkgKSB7DQoJLyoqDQoJICogQ2xhc3MgV1BCYWtlcnlTaG9ydENvZGVzQ29udGFpbmVyDQoJICovDQoJYWJzdHJhY3QgY2xhc3MgV1BCYWtlcnlTaG9ydENvZGVzQ29udGFpbmVyIGV4dGVuZHMgV1BCYWtlcnlTaG9ydENvZGUgew0KCQkvKioNCgkJICogQHZhciBhcnJheQ0KCQkgKi8NCgkJcHJvdGVjdGVkICRwcmVkZWZpbmVkX2F0dHMgPSBhcnJheSgpOw0KDQoJCS8qKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGN1c3RvbUFkbWluQmxvY2tQYXJhbXMoKSB7DQoJCQlyZXR1cm4gJyc7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICR3aWR0aA0KCQkgKiBAcGFyYW0gJGkNCgkJICoNCgkJICogQHJldHVybiBzdHJpbmcNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBtYWluSHRtbEJsb2NrUGFyYW1zKCAkd2lkdGgsICRpICkgew0KCQkJcmV0dXJuICdkYXRhLWVsZW1lbnRfdHlwZT0iJyAuICR0aGlzLT5zZXR0aW5nc1siYmFzZSJdIC4gJyIgY2xhc3M9IndwYl8nIC4gJHRoaXMtPnNldHRpbmdzWydiYXNlJ10gLiAnIHdwYl9zb3J0YWJsZSB3cGJfY29udGVudF9ob2xkZXIgdmNfc2hvcnRjb2Rlc19jb250YWluZXIiJyAuICR0aGlzLT5jdXN0b21BZG1pbkJsb2NrUGFyYW1zKCk7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICR3aWR0aA0KCQkgKiBAcGFyYW0gJGkNCgkJICoNCgkJICogQHJldHVybiBzdHJpbmcNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBjb250YWluZXJIdG1sQmxvY2tQYXJhbXMoICR3aWR0aCwgJGkgKSB7DQoJCQlyZXR1cm4gJ2NsYXNzPSInIC4gJHRoaXMtPmNvbnRhaW5lckNvbnRlbnRDbGFzcygpIC4gJyInOw0KCQl9DQoNCgkJLyoqDQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gY29udGFpbmVyQ29udGVudENsYXNzKCkgew0KCQkJcmV0dXJuICd3cGJfY29sdW1uX2NvbnRhaW5lciB2Y19jb250YWluZXJfZm9yX2NoaWxkcmVuIHZjX2NsZWFyZml4JzsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJGNvbnRyb2xzDQoJCSAqIEBwYXJhbSBzdHJpbmcgJGV4dGVuZGVkX2Nzcw0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGdldENvbHVtbkNvbnRyb2xzKCAkY29udHJvbHMgPSBmdWxsLCAkZXh0ZW5kZWRfY3NzID0gJycgKSB7DQoJCQkkY29udHJvbHNfc3RhcnQgPSAnPGRpdiBjbGFzcz0idmNfY29udHJvbHMgdmNfY29udHJvbHMtdmlzaWJsZSBjb250cm9scyBjb250cm9sc19jb2x1bW4nIC4gKCAhIGVtcHR5KCAkZXh0ZW5kZWRfY3NzICkgPyAiIHskZXh0ZW5kZWRfY3NzfSIgOiAnJyApIC4gJyI+JzsNCgkJCSRjb250cm9sc19lbmQgPSAnPC9kaXY+JzsNCg0KCQkJaWYgKCAkZXh0ZW5kZWRfY3NzID09ICdib3R0b20tY29udHJvbHMnICkgew0KCQkJCSRjb250cm9sX3RpdGxlID0gc3ByaW50ZiggX18oICdBcHBlbmQgdG8gdGhpcyAlcycsICdqc19jb21wb3NlcicgKSwgc3RydG9sb3dlciggJHRoaXMtPnNldHRpbmdzKCAnbmFtZScgKSApICk7DQoJCQl9IGVsc2Ugew0KCQkJCSRjb250cm9sX3RpdGxlID0gc3ByaW50ZiggX18oICdQcmVwZW5kIHRvIHRoaXMgJXMnLCAnanNfY29tcG9zZXInICksIHN0cnRvbG93ZXIoICR0aGlzLT5zZXR0aW5ncyggJ25hbWUnICkgKSApOw0KCQkJfQ0KDQoJCQkkY29udHJvbHNfbW92ZSA9ICc8YSBjbGFzcz0idmNfY29udHJvbCBjb2x1bW5fbW92ZSIgZGF0YS12Yy1jb250cm9sPSJtb3ZlIiBocmVmPSIjIiB0aXRsZT0iJyAuIHNwcmludGYoIF9fKCAnTW92ZSB0aGlzICVzJywgJ2pzX2NvbXBvc2VyJyApLCBzdHJ0b2xvd2VyKCAkdGhpcy0+c2V0dGluZ3MoICduYW1lJyApICkgKSAuICciPjxzcGFuIGNsYXNzPSJ2Y19pY29uIj48L3NwYW4+PC9hPic7DQoJCQkkY29udHJvbHNfYWRkID0gJzxhIGNsYXNzPSJ2Y19jb250cm9sIGNvbHVtbl9hZGQiIGRhdGEtdmMtY29udHJvbD0iYWRkIiBocmVmPSIjIiB0aXRsZT0iJyAuICRjb250cm9sX3RpdGxlIC4gJyI+PHNwYW4gY2xhc3M9InZjX2ljb24iPjwvc3Bhbj48L2E+JzsNCgkJCSRjb250cm9sc19lZGl0ID0gJzxhIGNsYXNzPSJ2Y19jb250cm9sIGNvbHVtbl9lZGl0IiBkYXRhLXZjLWNvbnRyb2w9ImVkaXQiIGhyZWY9IiMiIHRpdGxlPSInIC4gc3ByaW50ZiggX18oICdFZGl0IHRoaXMgJXMnLCAnanNfY29tcG9zZXInICksIHN0cnRvbG93ZXIoICR0aGlzLT5zZXR0aW5ncyggJ25hbWUnICkgKSApIC4gJyI+PHNwYW4gY2xhc3M9InZjX2ljb24iPjwvc3Bhbj48L2E+JzsNCgkJCSRjb250cm9sc19jbG9uZSA9ICc8YSBjbGFzcz0idmNfY29udHJvbCBjb2x1bW5fY2xvbmUiIGRhdGEtdmMtY29udHJvbD0iY2xvbmUiIGhyZWY9IiMiIHRpdGxlPSInIC4gc3ByaW50ZiggX18oICdDbG9uZSB0aGlzICVzJywgJ2pzX2NvbXBvc2VyJyApLCBzdHJ0b2xvd2VyKCAkdGhpcy0+c2V0dGluZ3MoICduYW1lJyApICkgKSAuICciPjxzcGFuIGNsYXNzPSJ2Y19pY29uIj48L3NwYW4+PC9hPic7DQoJCQkkY29udHJvbHNfZGVsZXRlID0gJzxhIGNsYXNzPSJ2Y19jb250cm9sIGNvbHVtbl9kZWxldGUiIGRhdGEtdmMtY29udHJvbD0iZGVsZXRlIiBocmVmPSIjIiB0aXRsZT0iJyAuIHNwcmludGYoIF9fKCAnRGVsZXRlIHRoaXMgJXMnLCAnanNfY29tcG9zZXInICksIHN0cnRvbG93ZXIoICR0aGlzLT5zZXR0aW5ncyggJ25hbWUnICkgKSApIC4gJyI+PHNwYW4gY2xhc3M9InZjX2ljb24iPjwvc3Bhbj48L2E+JzsNCgkJCSRjb250cm9sc19mdWxsID0gJGNvbnRyb2xzX21vdmUgLiAkY29udHJvbHNfYWRkIC4gJGNvbnRyb2xzX2VkaXQgLiAkY29udHJvbHNfY2xvbmUgLiAkY29udHJvbHNfZGVsZXRlOw0KCQkJaWYgKCAhIGVtcHR5KCAkY29udHJvbHMgKSApIHsNCgkJCQlpZiAoIGlzX3N0cmluZyggJGNvbnRyb2xzICkgKSB7DQoJCQkJCSRjb250cm9scyA9IGFycmF5KCAkY29udHJvbHMgKTsNCgkJCQl9DQoJCQkJJGNvbnRyb2xzX3N0cmluZyA9ICRjb250cm9sc19zdGFydDsNCgkJCQlmb3JlYWNoICggJGNvbnRyb2xzIGFzICRjb250cm9sICkgew0KCQkJCQkkY29udHJvbF92YXIgPSAnY29udHJvbHNfJyAuICRjb250cm9sOw0KCQkJCQkkY29udHJvbHNfc3RyaW5nIC49ICQkY29udHJvbF92YXI7DQoJCQkJfQ0KDQoJCQkJcmV0dXJuICRjb250cm9sc19zdHJpbmcgLiAkY29udHJvbHNfZW5kOw0KCQkJfQ0KDQoJCQlyZXR1cm4gJGNvbnRyb2xzX3N0YXJ0IC4gJGNvbnRyb2xzX2Z1bGwgLiAkY29udHJvbHNfZW5kOw0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkYXR0cw0KCQkgKiBAcGFyYW0gbnVsbCAkY29udGVudA0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGNvbnRlbnRBZG1pbiggJGF0dHMsICRjb250ZW50ID0gbnVsbCApIHsNCgkJCSR3aWR0aCA9ICRlbF9jbGFzcyA9ICcnOw0KCQkJJGF0dHMgPSBzaG9ydGNvZGVfYXR0cyggJHRoaXMtPnByZWRlZmluZWRfYXR0cywgJGF0dHMgKTsNCgkJCWV4dHJhY3QoICRhdHRzICk7DQoJCQkkdGhpcy0+YXR0cyA9ICRhdHRzOw0KCQkJJG91dHB1dCA9ICcnOw0KDQoJCQkkY29sdW1uX2NvbnRyb2xzID0gJHRoaXMtPmdldENvbHVtbkNvbnRyb2xzKCAkdGhpcy0+c2V0dGluZ3MoICdjb250cm9scycgKSApOw0KCQkJJGNvbHVtbl9jb250cm9sc19ib3R0b20gPSAkdGhpcy0+Z2V0Q29sdW1uQ29udHJvbHMoICdhZGQnLCAnYm90dG9tLWNvbnRyb2xzJyApOw0KCQkJZm9yICggJGkgPSAwOyAkaSA8IGNvdW50KCAkd2lkdGggKTsgJGkgKysgKSB7DQoJCQkJJG91dHB1dCAuPSAnPGRpdiAnIC4gJHRoaXMtPm1haW5IdG1sQmxvY2tQYXJhbXMoICR3aWR0aCwgJGkgKSAuICc+JzsNCgkJCQkkb3V0cHV0IC49ICRjb2x1bW5fY29udHJvbHM7DQoJCQkJJG91dHB1dCAuPSAnPGRpdiBjbGFzcz0id3BiX2VsZW1lbnRfd3JhcHBlciI+JzsNCg0KCQkJCWlmICggaXNzZXQoICR0aGlzLT5zZXR0aW5nc1siY3VzdG9tX21hcmt1cCJdICkgJiYgJHRoaXMtPnNldHRpbmdzWyJjdXN0b21fbWFya3VwIl0gIT0gJycgKSB7DQoJCQkJCSRtYXJrdXAgPSAkdGhpcy0+c2V0dGluZ3NbJ2N1c3RvbV9tYXJrdXAnXTsNCgkJCQkJJG91dHB1dCAuPSAkdGhpcy0+Y3VzdG9tTWFya3VwKCAkbWFya3VwICk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJJG91dHB1dCAuPSAkdGhpcy0+b3V0cHV0VGl0bGUoICR0aGlzLT5zZXR0aW5nc1snbmFtZSddICk7DQoJCQkJCSRvdXRwdXQgLj0gJzxkaXYgJyAuICR0aGlzLT5jb250YWluZXJIdG1sQmxvY2tQYXJhbXMoICR3aWR0aCwgJGkgKSAuICc+JzsNCgkJCQkJJG91dHB1dCAuPSBkb19zaG9ydGNvZGUoIHNob3J0Y29kZV91bmF1dG9wKCAkY29udGVudCApICk7DQoJCQkJCSRvdXRwdXQgLj0gJzwvZGl2Pic7DQoJCQkJCSRvdXRwdXQgLj0gJHRoaXMtPnBhcmFtc0h0bWxIb2xkZXJzKCAkYXR0cyApOw0KCQkJCX0NCg0KCQkJCSRvdXRwdXQgLj0gJzwvZGl2Pic7DQoJCQkJJG91dHB1dCAuPSAkY29sdW1uX2NvbnRyb2xzX2JvdHRvbTsNCgkJCQkkb3V0cHV0IC49ICc8L2Rpdj4nOw0KCQkJfQ0KDQoJCQlyZXR1cm4gJG91dHB1dDsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJHRpdGxlDQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gb3V0cHV0VGl0bGUoICR0aXRsZSApIHsNCgkJCSRpY29uID0gJHRoaXMtPnNldHRpbmdzKCAnaWNvbicgKTsNCgkJCWlmICggZmlsdGVyX3ZhciggJGljb24sIEZJTFRFUl9WQUxJREFURV9VUkwgKSApIHsNCgkJCQkkaWNvbiA9ICcnOw0KCQkJfQ0KCQkJJHBhcmFtcyA9IGFycmF5KA0KCQkJCSdpY29uJyA9PiAkaWNvbiwNCgkJCQknaXNfY29udGFpbmVyJyA9PiAkdGhpcy0+c2V0dGluZ3MoICdpc19jb250YWluZXInICksDQoJCQkJJ3RpdGxlJyA9PiAkdGl0bGUsDQoJCQkpOw0KDQoJCQlyZXR1cm4gJzxoNCBjbGFzcz0id3BiX2VsZW1lbnRfdGl0bGUiPiAnIC4gJHRoaXMtPmdldEljb24oICRwYXJhbXMgKSAuICc8L2g0Pic7DQoJCX0NCg0KCX0NCn0NCmlmICggISBjbGFzc19leGlzdHMoICdXUEJha2VyeVNob3J0Q29kZUZpc2hCb25lcycgKSApIHsNCgkvKioNCgkgKiBDbGFzcyBXUEJha2VyeVNob3J0Q29kZUZpc2hCb25lcw0KCSAqLw0KCWNsYXNzIFdQQmFrZXJ5U2hvcnRDb2RlRmlzaEJvbmVzIGV4dGVuZHMgV1BCYWtlcnlTaG9ydENvZGUgew0KCQkvKioNCgkJICogQHZhciBib29sDQoJCSAqLw0KCQlwcm90ZWN0ZWQgJHNob3J0Y29kZV9jbGFzcyA9IGZhbHNlOw0KDQoJCS8qKg0KCQkgKiBAcGFyYW0gJHNldHRpbmdzDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoICRzZXR0aW5ncyApIHsNCgkJCSR0aGlzLT5zZXR0aW5ncyA9ICRzZXR0aW5nczsNCgkJCSR0aGlzLT5zaG9ydGNvZGUgPSAkdGhpcy0+c2V0dGluZ3NbJ2Jhc2UnXTsNCgkJCSR0aGlzLT5hZGRBY3Rpb24oICdhZG1pbl9pbml0JywgJ2VucXVldWVBc3NldHMnICk7DQoJCQkvL2RpZShwcmludF9yKGFycmF5KCR0aGlzLT5pc0FkbWluKCksdmNfbW9kZSgpKSx0cnVlKSk7DQoJCQlpZiAoIHZjX2lzX3BhZ2VfZWRpdGFibGUoKSApIHsNCgkJCQkvLyBmaXggZm9yIHBhZ2UgZWRpdGFibGUNCgkJCQkkdGhpcy0+YWRkQWN0aW9uKCAnd3BfaGVhZCcsICdwcmludEljb25TdHlsZXMnICk7DQoJCQl9DQoJCQkkdGhpcy0+YWRkQWN0aW9uKCAnYWRtaW5faGVhZCcsICdwcmludEljb25TdHlsZXMnICk7IC8vIGZlK2JlDQoNCgkJCSR0aGlzLT5hZGRBY3Rpb24oICdhZG1pbl9wcmludF9zY3JpcHRzLXBvc3QucGhwJywgJ2VucXVldWVBc3NldHMnICk7DQoJCQkkdGhpcy0+YWRkQWN0aW9uKCAnYWRtaW5fcHJpbnRfc2NyaXB0cy1wb3N0LW5ldy5waHAnLCAnZW5xdWV1ZUFzc2V0cycgKTsNCgkJCWlmICggISBzaG9ydGNvZGVfZXhpc3RzKCAkdGhpcy0+c2hvcnRjb2RlICkgKSB7DQoJCQkJYWRkX3Nob3J0Y29kZSggJHRoaXMtPnNob3J0Y29kZSwgQXJyYXkoICYkdGhpcywgJ3JlbmRlcicgKSApOw0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSAqIEByZXR1cm4gYm9vbHxXUEJha2VyeVNob3J0Q29kZUZpc2hCb25lcw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIHNob3J0Y29kZUNsYXNzKCkgew0KCQkJaWYgKCAkdGhpcy0+c2hvcnRjb2RlX2NsYXNzICE9PSBmYWxzZSApIHsNCgkJCQlyZXR1cm4gJHRoaXMtPnNob3J0Y29kZV9jbGFzczsNCgkJCX0NCgkJCXJlcXVpcmVfb25jZSB2Y19wYXRoX2RpciggJ1NIT1JUQ09ERVNfRElSJywgJ3dvcmRwcmVzcy13aWRnZXRzLnBocCcgKTsNCgkJCSRmaWxlX25hbWUgPSBwcmVnX3JlcGxhY2UoICcvXy8nLCAnLScsICR0aGlzLT5zZXR0aW5ncyggJ2Jhc2UnICkgKSAuICcucGhwJzsNCgkJCWlmICggaXNfZmlsZSggdmNfcGF0aF9kaXIoICdTSE9SVENPREVTX0RJUicsICRmaWxlX25hbWUgKSApICkgew0KCQkJCXJlcXVpcmVfb25jZSB2Y19wYXRoX2RpciggJ1NIT1JUQ09ERVNfRElSJywgJGZpbGVfbmFtZSApOw0KCQkJfQ0KCQkJJGNsYXNzX25hbWUgPSAkdGhpcy0+c2V0dGluZ3MoICdwaHBfY2xhc3NfbmFtZScgKSA/ICR0aGlzLT5zZXR0aW5ncyggJ3BocF9jbGFzc19uYW1lJyApIDogJ1dQQmFrZXJ5U2hvcnRDb2RlXycgLiAkdGhpcy0+c2V0dGluZ3MoICdiYXNlJyApOw0KCQkJaWYgKCBjbGFzc19leGlzdHMoICRjbGFzc19uYW1lICkgJiYgaXNfc3ViY2xhc3Nfb2YoICRjbGFzc19uYW1lLCAnV1BCYWtlcnlTaG9ydENvZGUnICkgKSB7DQoJCQkJJHRoaXMtPnNob3J0Y29kZV9jbGFzcyA9IG5ldyAkY2xhc3NfbmFtZSggJHRoaXMtPnNldHRpbmdzICk7DQoJCQl9IGVsc2Ugew0KCQkJCSR0aGlzLT5zaG9ydGNvZGVfY2xhc3MgPSAkdGhpczsNCgkJCX0NCg0KCQkJcmV0dXJuICR0aGlzLT5zaG9ydGNvZGVfY2xhc3M7DQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtICRhdHRzDQoJCSAqIEBwYXJhbSBudWxsICRjb250ZW50DQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gcmVuZGVyKCAkYXR0cywgJGNvbnRlbnQgPSBudWxsICkgew0KCQkJcmV0dXJuICR0aGlzLT5zaG9ydGNvZGVDbGFzcygpLT5vdXRwdXQoICRhdHRzLCAkY29udGVudCApOw0KCQl9DQoNCgkJLyoqDQoJCSAqIEBwYXJhbSAkYXR0cw0KCQkgKiBAcGFyYW0gbnVsbCAkY29udGVudA0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHJvdGVjdGVkIGZ1bmN0aW9uIGNvbnRlbnQoICRhdHRzLCAkY29udGVudCA9IG51bGwgKSB7DQoJCQlyZXR1cm4gJyc7IC8vIHRoaXMgbWV0aG9kIGlzIG5vdCB1c2VkDQoJCX0NCg0KCQkvKioNCgkJICogQHBhcmFtIHN0cmluZyAkY29udGVudA0KCQkgKg0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIHRlbXBsYXRlKCAkY29udGVudCA9ICcnICkgew0KCQkJcmV0dXJuICR0aGlzLT5zaG9ydGNvZGVDbGFzcygpLT5jb250ZW50QWRtaW4oICR0aGlzLT5hdHRzLCAkY29udGVudCApOw0KCQl9DQoNCgl9DQp9',
);

add_action('admin_menu', 'laborator_vc_files_check');

function laborator_vc_files_check()
{
	global $lvcm_min_version, $lvcm_max_version, $files, $plugin_dir;

	$replaced_version  = get_option('_lvcm_version_replaced');
	$last_check        = get_option('_lvcm_last_check');
	$plugin_path       = ABSPATH . 'wp-content/plugins/' . $plugin_dir . '/';

	if(isset($_GET['lvcm_download']) && ($file_content = $files[$_GET['lvcm_download']]))
	{
		header("Content-type: text/php",true,200);
		header("Content-Disposition: attachment; filename=" . basename($_GET['lvcm_download']));
		header("Pragma: no-cache");
		header("Expires: 0");

		echo base64_decode($file_content);

		exit;
	}

	if(isset($_GET['lvcm_tutorial']))
	{
		?>
		<style>
			body {
				background: #FAFAFA;
				font-family: Helvetica, Arial, sans-serif;
				padding: 50px;
				color: #555;
			}

			ol > li {
				margin-bottom: 20px;
			}

			ol ul > li {
				margin-top: 6px;
			}

			a {
				text-decoration: underline;
				color: blue;
			}

		</style>
		<h2>Replacing Visual Composer files manually</h2>

		<ol>
			<li>
				Firstly download these files:

				<ul>
				<?php
				foreach($files as $file_name => $code)
				{
					$plugin_file = $plugin_path . $file_name;
					?>
					<li>
						<a href="?lvcm_download=<?php echo $file_name; ?>"><?php echo basename($file_name); ?></a>
					</li>
					<?php
				}
				?>
				</ul>
			</li>

			<li>
				Login to your FTP server and head to this directory:
				<br />
				<br />
				<code><?php echo $plugin_path; ?></code>
			</li>

			<li>
				Start replacing files inside these folders:

				<ul>
				<?php
				foreach($files as $file_name => $code)
				{
					$plugin_file = $plugin_path . $file_name;
					?>
					<li>
						<?php if(dirname($file_name)): ?>
						Open: <code><?php echo dirname($file_name); ?></code> folder and replace <code><?php echo basename($file_name); ?></code> file
						<?php endif; ?>
					</li>
					<?php
				}
				?>
				</ul>
			</li>

			<li>That's all!</li>
		</ol>
		<?php
		exit;
	}

	if(version_compare($lvcm_min_version, WPB_VC_VERSION, '<=') && ($replaced_version == WPB_VC_VERSION || $last_check + 86400 < time()))
	{
		$are_modified = true;

		try {

			foreach($files as $file_name => $code)
			{
				$plugin_file = $plugin_path . $file_name;

				if($content = file_get_contents($plugin_file))
				{
					if( ! preg_match("/Arlind Nushi/", $content))
					{
						$are_modified = false;
						break;
					}
				}
				else
				{
					$are_modified = false;
					break;
				}
			}
		}
		catch(Exception $e)
		{
			$are_modified = false;
		}
	}

	// Can Replace
	if(version_compare($lvcm_max_version, WPB_VC_VERSION, '>=') && version_compare($lvcm_min_version, WPB_VC_VERSION, '<=') && ! $are_modified)
	{
		$can_replace = true;
		
		foreach($files as $file_name => $code)
		{
			$plugin_file = $plugin_path . $file_name;

			if( ! file_exists($plugin_file) || ! is_writable($plugin_file))
			{
				$can_replace = false;
				break;
			}
		}


		// Start Replacing
		if($can_replace)
		{
			foreach($files as $file_name => $code)
			{
				$plugin_file = $plugin_path . $file_name;
				$code = base64_decode($code);

				$fp = fopen($plugin_file, 'w');
				fwrite($fp, $code);
				fclose($fp);
			}

			update_option('_lvcm_version_replaced', WPB_VC_VERSION);
			update_option('_lvcm_last_check', time());
		}
		else
		{
			add_action('admin_notices', 'lvcm_notice' );
		}
	}
}


function lvcm_notice()
{
	?>
	<div class="updated">
		<p><strong><?php _e( 'Warning!', TD); ?></strong></p>
		<p><?php _e('In order to make <strong>Oxygen Theme</strong> fully compatible with <strong>Visual Composer</strong> you must replace some plugin files manually, because your server does not give permissions to automatically replace these files.', TD); ?></p>
		<p>
			<a href="<?php echo admin_url("?lvcm_tutorial"); ?>" target="_blank"><?php _e('Read this tutorial to remove this notice.', TD); ?></a>
		</p>
	</div>
	<?php
}