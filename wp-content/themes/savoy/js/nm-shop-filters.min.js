/* NM: Shop filters script */
(function(c){c.extend(c.nmTheme,{filters_init:function(){this.$shopFilterMenu=c("#nm-shop-filter-menu");this.filterPanelSliding=!1;this.filterPanelSlideSpeed=200;this.filterPanelHideWidth=551;this.filterScrollbars="1"==nm_wp_vars.shopFilterScrollbars?!0:!1;this.filterScrollbarsLoaded=!1;this.shopFilterMenuFnNames={cat:"shopFiltersCategoriesToggle",filter:"shopFiltersSidebarToggle",search:"shopFiltersSearchToggle"};this.shopFiltersBind()},shopFiltersBind:function(){var a=this;a.$shopFilterMenu.find("a").bind("click",
function(b){b.preventDefault();if(!a.filterPanelSliding){a.shopRemoveNotices();a.filterPanelSliding=!0;b=0;var e=c(this).parent("li"),d=e.data("panel");e.hasClass("active")||(b=a.shopFiltersHideActivePanel());e.toggleClass("active");setTimeout(function(){a[a.shopFilterMenuFnNames[d]]()},b)}});a.filtersEnableAjax&&a.$pageIncludes.hasClass("shop_categories")&&(c("#nm-categories-count").text(c("#nm-shop-categories").children().length-1),a.$shopWrap.on("click","#nm-shop-categories a",function(b){b.preventDefault();
b=c(this);var e=b.parent("li");a.searchEnabled&&a.$searchBtn.parent("li").hasClass("active")&&(a.categoryClicked=!0,a.$searchBtn.trigger("click"));c("#nm-shop-categories").children(".current-cat").removeClass("current-cat");e.addClass("current-cat");a.shopGetPage(b.attr("href"))}));a.$shopWrap.on("click","#nm-shop-sidebar .nm-widget-title",function(a){c(this).parent().toggleClass("show")});a.filtersEnableAjax&&a.$pageIncludes.hasClass("shop_filters")&&(a.$shopWrap.on("click","#nm-shop-sidebar .nm_widget a",
function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_product_categories a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav_filters a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click",
"#nm-shop-sidebar .widget_product_tag_cloud a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"),!1,!0)}))},shopFiltersCategoriesToggle:function(){var a=this;c("#nm-shop-categories").slideToggle(a.filterPanelSlideSpeed,function(){var b=c(this);b.toggleClass("fade-in");b.hasClass("fade-in")||b.removeClass("force-show").css("display","");a.filterPanelSliding=!1})},shopFiltersCategoriesReset:function(){c("#nm-shop-categories").removeClass("fade-in force-show").css("display","")},shopFiltersSidebarToggle:function(){var a=
this,b=c("#nm-shop-sidebar"),e=b.is(":visible");e&&b.removeClass("fade-in");b.slideToggle(a.filterPanelSlideSpeed,function(){e||b.addClass("fade-in");a.filterPanelSliding=!1;a.filterScrollbars&&!a.filterScrollbarsLoaded&&a.filterScrollbarsInit()})},shopFiltersSearchToggle:function(){this.searchPanelToggle();this.currentSearch=""},shopFiltersHideActivePanel:function(){var a=0,b=this.$shopFilterMenu.children(".active");if(b.length){b.removeClass("active");var c=b.data("panel");b.is(":hidden")&&"cat"==
c?this.shopFiltersCategoriesReset():(a=300,this[this.shopFilterMenuFnNames[c]]())}return a},shopExternalGetPage:function(a){var b=this;if(a==window.location.href)b.shopScrollToTop();else{c("#nm-shop-categories").children(".current-cat").removeClass("current-cat");var e=b.shopMaybeScrollToTop();setTimeout(function(){b.shopGetPage(a)},e)}},shopGetPage:function(a,b,e){var d=this;if(d.shopAjax)return!1;a&&(d.shopRemoveNotices(),d.shopSetCurrentUrl(e),d.$body.width()<d.filterPanelHideWidth?(d.shopShowLoader(!0),
e=d.filterPanelSlideSpeed,d.filterPanelSlideSpeed=0,d.shopFiltersHideActivePanel(),d.shopScrollToTop(),d.filterPanelSlideSpeed=e):d.shopShowLoader(),a=a.replace(/\/?(\?|#|$)/,"/$1"),b||d.setPushState(a),d.shopAjax=c.ajax({url:a,data:{shop_load:"full"},dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"POST",error:function(a,b,c){console.log("NM: AJAX error - shopGetPage() - "+c);d.shopHideLoader();d.shopAjax=!1},success:function(a){d.shopUpdateContent(a);d.shopAjax=!1}}))},shopUpdateContent:function(a){var b=
this,e=c("<div>"+a+"</div>"),d=e.find("#nm-shop-categories");a=e.find("#nm-shop-sidebar");e=e.find("#nm-shop-browse-wrap");if(d.length){var f=c("#nm-shop-categories");f.hasClass("fade-in")&&d.addClass("fade-in force-show");f.replaceWith(d)}a.length&&(d=c("#nm-shop-sidebar"),d.hasClass("fade-in")?(a.addClass("fade-in force-show"),d.replaceWith(a),b.filterScrollbars&&b.filterScrollbarsInit()):(d.replaceWith(a),b.filterScrollbarsLoaded=!1));e.length&&b.$shopBrowseWrap.replaceWith(e);b.$shopBrowseWrap=
c("#nm-shop-browse-wrap");b.shopLoadImages();b.shopInfLoadBound||b.infload_init();a=b.shopMaybeScrollToTop();setTimeout(function(){b.shopHideLoader()},a)}});c.nmThemeExtensions.filters=c.nmTheme.filters_init})(jQuery);