/* NM: Shop script */
(function(b){b.extend(b.nmTheme,{shop_init:function(){var a=this;a.shopSelectConfig={onOpen:function(){var a=b(this);a.closest("li").addClass("open");a.children("select").trigger("focusin")},onChange:function(){b(this).closest("li").removeClass("open")},onClose:function(){b(this).closest("li").removeClass("open")}};if(a.isShop){a.shopAjax=!1;a.shopScrollOffset=parseInt(nm_wp_vars.shopScrollOffset);a.infloadScroll=!1;a.categoryClicked=!1;a.shopLoaderSpeed=300;a.shopScrollSpeed=410;a.$shopBrowseWrap=
b("#nm-shop-browse-wrap");a.imageLazyLoading="0"!=nm_wp_vars.shopImageLazyLoad?!0:!1;a.filtersEnableAjax="0"!=nm_wp_vars.shopFiltersAjax?a.isTouch&&"1"!=nm_wp_vars.shopFiltersAjax?!1:!0:!1;a.isProductTagUrl=a.$body.hasClass("tax-product_tag")?!0:!1;a.searchAndTagsResetURL=null;a.shopSetMinHeight();var c=null;a.$window.resize(function(){c&&clearTimeout(c);c=setTimeout(function(){a.shopSetMinHeight()},250)});if(a.$pageIncludes.hasClass("banner-slider"))a.$document.on("banner-slider-loaded",function(){a.shopUrlHashScroll();
a.shopLoadImages()});else a.shopUrlHashScroll(),a.shopLoadImages();a.$window.on("popstate.nmshop",function(b){b.originalEvent.state&&b.originalEvent.state.nmShop&&a.shopGetPage(window.location.href,!0)});b("#nm-main-menu-ul").children(".shop-link").find("> a").bind("click",function(b){b.preventDefault();a.shopMaybeScrollToTop()});a.$shopWrap.on("click","#nm-shop-results-reset",function(d){d.preventDefault();d=!b(this).closest(".nm-shop-results-bar").hasClass("is-category")&&a.searchAndTagsResetURL?
a.searchAndTagsResetURL:b(this).data("shop-url");a.shopGetPage(d)})}a.$document.on("woocommerce_update_variation_values","#nm-variations-form",function(){b("#nm-variations-form").find("select").each(function(){b(this).selectOrDie("update")})});if(a.$pageIncludes.hasClass("products"))if(a.isShop)b("#nm-shop-products").on("hover",".nm-products li.hover-image-load",function(){a.productLoadHoverImage(b(this))});else b(".nm-products").on("hover",".hover-image-load",function(){a.productLoadHoverImage(b(this))});
"undefined"!==typeof wc_add_to_cart_params&&"yes"!==wc_add_to_cart_params.cart_redirect_after_add?(a.$body.on("adding_to_cart",function(b,c,g,f){a.quickviewIsOpen(f)||a.widgetPanelShowCart(!0)}),a.$body.on("added_to_cart",function(b,c,g,f){a.quickviewIsOpen(f)||a.widgetPanelHideCartLoader()})):a.$document.off("click",".add_to_cart_button");b("#nm-breadcrumb").find("a").bind("click",function(a){a.preventDefault();a=b(this).attr("href");window.location.href=a+"#shop"});a.shopLoadExtension()},shopLoadExtension:function(){"0"!==
nm_wp_vars.shopAjaxAddToCart&&b.nmThemeExtensions.add_to_cart&&b.nmThemeExtensions.add_to_cart.call(this);this.isShop&&(b.nmThemeExtensions.infload&&b.nmThemeExtensions.infload.call(this),b.nmThemeExtensions.filters&&(b.nmThemeExtensions.filters.call(this),b.nmThemeExtensions.filters_scrollbar&&b.nmThemeExtensions.filters_scrollbar.call(this)),this.searchEnabled&&b.nmThemeExtensions.search&&b.nmThemeExtensions.search.call(this));this.$pageIncludes.hasClass("quickview")&&b.nmThemeExtensions.quickview&&
b.nmThemeExtensions.quickview.call(this)},shopUrlHashScroll:function(){"#shop"===window.location.hash&&this.shopMaybeScrollToTop(!0)},shopToggleVariationDetails:function(){var a=b("#nm-single-variation");a.children().length?a.addClass("show"):a.removeClass("show")},shopSetCurrentUrl:function(a){this.isProductTagUrl||(this.searchAndTagsResetURL=window.location.href);this.isProductTagUrl=a?!0:!1},shopInitQuantity:function(a){a.find(".quantity").append('<div class="nm-qty-plus nm-font nm-font-media-play rotate-270"></div>').prepend('<div class="nm-qty-minus nm-font nm-font-media-play rotate-90"></div>');
a.on("click",".nm-qty-plus, .nm-qty-minus",function(){var a=b(this),d=a.closest(".quantity").find(".qty"),e=parseFloat(d.val()),g=parseFloat(d.attr("max")),f=parseFloat(d.attr("min")),h=d.attr("step");e&&""!==e&&"NaN"!==e||(e=0);if(""===g||"NaN"===g)g="";if(""===f||"NaN"===f)f=0;if("any"===h||""===h||void 0===h||"NaN"===parseFloat(h))h=1;a.hasClass("nm-qty-plus")?g&&(g==e||e>g)?d.val(g):d.val(e+parseFloat(h)):f&&(f==e||e<f)?d.val(f):0<e&&d.val(e-parseFloat(h))})},shopLoadImages:function(){if(this.imageLazyLoading){this.$window.off("scroll.unveil resize.unveil lookup.unveil");
var a=this.$shopBrowseWrap.find(".nm-products li:not(.image-loaded) .nm-shop-loop-thumbnail .unveil-image");a.length&&a.unveil(1,function(){b(this).parents("li").first().addClass("image-loaded")})}},shopSetMinHeight:function(){var a=b("#nm-footer").outerHeight(!0);this.$shopWrap.css("min-height",this.$window.height()-(a+this.shopScrollOffset)+"px")},shopMaybeScrollToTop:function(a){var c=0;this.shopSetMinHeight();var d=Math.round(this.$shopWrap.offset().top-this.shopScrollOffset);this.$document.scrollTop()+
100<d&&(c=this.shopScrollSpeed,a?this.$window.scrollTop(d):b("html, body").animate({scrollTop:d},this.shopScrollSpeed));return c},shopScrollToTop:function(a){var c=Math.round(this.$shopWrap.offset().top-this.shopScrollOffset);a?b("html, body").scrollTop(c):b("html, body").animate({scrollTop:c},this.shopScrollSpeed)},shopRemoveNotices:function(){b("#nm-shop-notices-wrap").empty()},shopShowLoader:function(a){var c=b("#nm-shop-products-overlay");a&&c.addClass("no-anim");c.addClass("show")},shopHideLoader:function(a){var c=
b("#nm-shop-products-overlay");a||c.removeClass("no-anim");c.removeClass("nm-loader").addClass("fade-out");setTimeout(function(){c.removeClass("show fade-out").addClass("nm-loader")},this.shopLoaderSpeed);this.infloadScroll&&(this.infscrollLock=!1,this.$window.trigger("scroll"))},quickviewIsOpen:function(a){return a&&1==a?!0:b("#nm-quickview").is(":visible")},productLoadHoverImage:function(a){if(!a.hasClass("hover-image-loading")){var c=a.find(".nm-shop-loop-thumbnail .hover-image"),d=c.attr("data-src");
d?(a.addClass("hover-image-loading"),c.load(function(){var a=b(this),c=a.closest("li");a.unbind("load");c.addClass("hover-image-loaded").removeClass("hover-image-load hover-image-loading")}),c.attr("src",d)):(console.log("NM: No image src found - productLoadHoverImage()"),a.removeClass("hover-image-load"))}}});b.nmThemeExtensions.shop=b.nmTheme.shop_init})(jQuery);