/* NM: Shop infinite load script */
(function(e){e.extend(e.nmTheme,{infload_init:function(){var a=this.$shopBrowseWrap.children(".nm-pagination");a.length&&a.hasClass("nm-infload")&&this.shopInfLoadBind()},shopInfLoadBind:function(){var a=this,b=a.$shopBrowseWrap.children(".nm-infload-controls");a.shopInfLoadBound=!0;a.infloadScroll=b.hasClass("scroll-mode")?!0:!1;if(a.infloadScroll){a.infscrollLock=!1;var f,c=Math.round(a.$document.height()-b.offset().top),d=null;a.$window.resize(function(){d&&clearTimeout(d);d=setTimeout(function(){var b=
a.$shopBrowseWrap.children(".nm-infload-controls");c=Math.round(a.$document.height()-b.offset().top)},100)});a.$window.bind("smartscroll.infscroll",function(){a.infscrollLock||(f=0+a.$document.height()-a.$window.scrollTop()-a.$window.height(),f<c&&a.shopInfLoadGetPage())})}else b=e("#nm-shop-products"),b.on("click",".nm-infload-btn",function(b){b.preventDefault();a.shopInfLoadGetPage()}),b.on("click",".nm-infload-to-top",function(b){b.preventDefault();a.shopScrollToTop()});a.infloadScroll&&a.$window.trigger("scroll")},
shopInfLoadGetPage:function(){var a=this;if(a.shopAjax)return!1;a.shopRemoveNotices();var b=a.$shopBrowseWrap.children(".nm-infload-link").find("a"),f=a.$shopBrowseWrap.children(".nm-infload-controls"),c=b.attr("href");c?(c=a.updateUrlParameter(c,"shop_load","products"),f.addClass("nm-loader"),a.shopAjax=e.ajax({url:c,dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"GET",error:function(a,b,c){console.log("NM: AJAX error - shopInfLoadGetPage() - "+c)},complete:function(){f.removeClass("nm-loader")},
success:function(d){d=e("<div>"+d+"</div>");var g=d.children(".nm-products").children("li");a.$shopBrowseWrap.find(".nm-products").append(g);a.shopLoadImages();(c=d.find(".nm-infload-link").children("a").attr("href"))?b.attr("href",c):(a.$shopBrowseWrap.addClass("all-products-loaded"),a.infloadScroll?a.infscrollLock=!0:f.addClass("hide-btn"),b.removeAttr("href"));a.shopAjax=!1;a.infloadScroll&&a.$window.trigger("scroll")}})):a.infloadScroll&&(a.infscrollLock=!0)}});e.nmThemeExtensions.infload=e.nmTheme.infload_init})(jQuery);