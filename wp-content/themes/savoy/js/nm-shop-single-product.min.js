/* NM: Single product script */
(function(b){b.extend(b.nmTheme,{singleProduct_init:function(){this.zoomEnabled=!1;this.singleProductVariationsInit();this.shopInitQuantity(b("#nm-product-summary"));this.singleProductFeaturedVideoInit();this.singleProductGalleryInit();var a=b("#nm-comment-form-rating");a.on("click.nmAddParentClass",".stars a",function(){a.children(".stars").addClass("has-active")});var e=b("#nm-upsells").find(".nm-shop-loop-thumbnail .unveil-image"),f=b("#nm-related").find(".nm-shop-loop-thumbnail .unveil-image"),
d=b.merge(e,f);this.$window.load(function(){d.length&&d.unveil(1,function(){b(this).parents("li").first().addClass("image-loaded")})})},singleProductVariationsInit:function(){var a=this;a.$variationsForm=b("#nm-variations-form");a.$variationsWrap=a.$variationsForm.children(".variations");a.$variationsWrap.find("select").selectOrDie(a.shopSelectConfig);a.shopToggleVariationDetails();a.$variationsForm.on("found_variation",function(){a.shopToggleVariationDetails()});a.$variationsForm.on("woocommerce_variation_select_change",
function(){a.$productImageSlider&&a.$productImageSlider.length&&a.$productImageSlider.slick("slickGoTo",0,!1);a.zoomEnabled&&a.singleProductZoomUpdateImage()})},singleProductZoomUpdateImage:function(){var a=this.$productImageSlider.find(".slick-slide").first(),b=a.children("a").attr("href");a.data("easyZoom").swap(b)},singleProductFeaturedVideoInit:function(){var a=this;a.hasFeaturedVideo=!1;a.$featuredVideoBtn=b("#nm-featured-video-link");a.$featuredVideoBtn.length&&(a.hasFeaturedVideo=!0,a.$featuredVideoBtn.bind("click",
function(b){b.preventDefault();a.$featuredVideoBtn.magnificPopup({mainClass:"nm-featured-video-popup nm-mfp-fade-in",closeMarkup:'<a class="mfp-close nm-font nm-font-close2"></a>',removalDelay:180,type:"iframe",closeOnContentClick:!0,closeBtnInside:!1}).magnificPopup("open")}))},singleProductGalleryInit:function(){var a=this;if(b("#nm-page-includes").hasClass("product-gallery")){a.$productImageSlider=b("#nm-product-images-slider");var e=b("#nm-product-images-col"),f=a.$productImageSlider.children("div"),
d=b("#nm-product-thumbnails-slider"),k=d.children("div"),n=k.first(),g=k.length,g=6<g?6:g,l=!1,t=e.hasClass("modal-enabled");a.zoomEnabled=!a.isTouch&&e.hasClass("zoom-enabled");if(a.zoomEnabled)a.$productImageSlider.on("init",function(){f.easyZoom()});if(t)a.$productImageSlider.on("init",function(){f.bind("click",function(c){a.$productImageSlider.hasClass("animating")||(c.preventDefault(),c=b(this).index(),a.hasFeaturedVideo?0==c&&a.$featuredVideoBtn.hasClass("modal-override")?a.$featuredVideoBtn.trigger("click"):
p(this,c):p(this,c))})});else if(a.hasFeaturedVideo)a.$productImageSlider.on("init",function(){f.bind("click",function(b){a.$productImageSlider.hasClass("animating")||(b.preventDefault(),a.$featuredVideoBtn.trigger("click"))})});a.$productImageSlider.on("beforeChange",function(b,f,e,h){l||d.find(".slick-slide").eq(h).trigger("click");l=!1;a.$productImageSlider.addClass("animating")});a.$productImageSlider.on("afterChange",function(){a.$productImageSlider.removeClass("animating")});a.$productImageSlider.slick({adaptiveHeight:!0,
slidesToShow:1,slidesToScroll:1,prevArrow:'<a class="slick-prev"><i class="nm-font nm-font-play flip"></i></a>',nextArrow:'<a class="slick-next"><i class="nm-font nm-font-play"></i></a>',dots:!0,fade:!0,cssEase:"linear",infinite:!1,speed:300});d.on("init",function(){k.bind("click",function(){var c=b(this);a.$productImageSlider.hasClass("animating")||c.hasClass("current")||(l=!0,n.removeClass("current"),c.addClass("current"),n=c,c.next().hasClass("slick-active")?c.prev().hasClass("slick-active")||
d.slick("slickPrev"):d.slick("slickNext"),a.$productImageSlider.slick("slickGoTo",c.index(),!1))})});d.slick({slidesToShow:g,slidesToScroll:1,arrows:!1,infinite:!1,focusOnSelect:!1,vertical:!0,draggable:!1,speed:300,swipe:!1,touchMove:!1});var p=function(c,e){var g,h,k,l=[],q,n;f.each(function(){g=b(this);h=g.children("a");k=h.children("img");q=h.data("size").split("x");n={src:h.attr("href"),w:parseInt(q[0],10),h:parseInt(q[1],10),msrc:k.attr("src"),el:h[0]};l.push(n)});var m={index:e,showHideOpacity:!0,
bgOpacity:1,loop:!1,mainClass:"pswp--minimal--dark",barsSize:{top:0,bottom:0},captionEl:!1,fullscreenEl:!1,zoomEl:!1,shareE1:!1,counterEl:!1,tapToClose:!0,tapToToggleControls:!1},p=b("#pswp")[0],m=new PhotoSwipe(p,PhotoSwipeUI_Default,l,m);m.init();m.listen("initialZoomIn",function(){d.slick("slickSetOption","speed",0)});var r=e;m.listen("beforeChange",function(b){r+=b;a.$productImageSlider.slick("slickGoTo",r,!0)});m.listen("close",function(){d.slick("slickSetOption","speed",300)})}}}});b.nmThemeExtensions.singleProduct=
b.nmTheme.singleProduct_init})(jQuery);